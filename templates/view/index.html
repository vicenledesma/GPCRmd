<head>


    <script src="https://cdn.plot.ly/plotly-2.4.2.min.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart"],"language":"en"});
    </script>
    <script>document.domain=document.domain;</script>
{% extends "home/base.html" %} 
{% load static %} 

{% load view_custom %}         

{% block addon_css %}
<link rel="stylesheet" type="text/css" href="{% static 'view/css/index.css' %}" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
{% endblock %}


</head>
<body>

{% block content %} 
{% csrf_token %}


 <!-- description  -->
 <div class="col-md-12" id="page_info">

  <!-- <div class="col-md-12 panel panel-primary" style="background-color:#3278B4;text-align:center;color:white;margin-bottom:10px">   -->
   <div class="panel panel-primary" style="background-color:#3278B4;text-align:center;margin-bottom:10px;color:white;margin: 0 7px; overflow:auto;">  
       <div class="panel-body" style="min-width:400px;padding-bottom:10px">
          <div style="float:left;" id="aroundtitle">
          <h2 >GPCRmd Workbench</h2>
          </div>
        <div class="howtoparent" style="">
            <a href="https://youtu.be/sNQNWcBhIyg" class="btn btn-default btn-sm howtobtn"  target="_blank" role="button" style="">How to<br>use it<br><span class="glyphicon glyphicon-play" style="font-size:14px"></span></a>
        </div>
       </div> 
   </div>

   <div id="inner_remaining" >
  
    <div id="group_height" class="col-md-12" style="height:100%;padding-bottom:20px;">
    <div class="row" id="row_info" style="padding:0 7px">
     <div class="col-md-12 panel panel-primary" style="margin-bottom:10px">
         <div id="show_hide_info" class="section_pan"  data-target="#more_info" data-toggle="collapse" style="cursor:pointer"><span id="show_hide_info_text" style="margin-left:5px;font-size:12px">Show info </span><span class="glyphicon glyphicon-chevron-down arrow"></span></div> 
     </div>

     
     <div class="col-md-12 panel panel-primary collapse" id="more_info" style="margin-bottom:10px">
         <div class="panel-body">

            <div style="text-align:center"> 
             <!--<h4 >GPCR VIEWER</h4>-->
            </div>
             <p style="text-align: justify;">Indicate what you want to display in your molecular representation using the selection options of the GPCRmd Viewer.</p>

         <p style="text-align: justify;">You can choose one of the selections we propose or define a new one (Customized selection option) using the <a href="http://nglviewer.org/ngl/api/manual/usage/selection-language.html" target="_blank">NGL selection language</a>.<p>
        {% if gpcr_pdb != "no" %}
            <p style="text-align: justify;">Protein residues can be indicated as  <a href="http://docs.gpcrdb.org/generic_numbering.html" target="_blank" >generic GPCR residue numbers</a> (Ballesteros-Weinstein or GPCRdb structure-based numbering).</p>
        {% endif %}
<!--        <p style="text-align: justify;">If you wish to use more complex visualization options, you can open your structure in <a href="http://arose.github.io/mdsrv/" target="_blank" >MDsrv</a>.</p>-->
        <p style="text-align: justify;">Visualization and trajectory sharing powered by <a href="http://nglviewer.org/ngl/api/index.html" target="_blank" >NGL Viewer</a> and <a href="http://nglviewer.org/mdsrv/" target="_blank" >MDsrv</a>.</p>        
        
        <p style="text-align: justify;">The hydrogen bonding network has been generated using <a href="https://github.com/GPCRviz/flareplot" target="_blank" >Flare Plots</a>, powered by R. Fonseca and A. J. Venkatakrishnan.</p>

        <p style="text-align: justify;">Mutant and variant information obtained from <a href="https://www.gpcrdb.org/" target="_blank" >GPCRdb</a> and <a href="https://gnomad.broadinstitute.org/" target="_blank" >gnomAD</a>.</p>
        
             <p style="text-align: justify;margin-bottom:4px;font-weight:bold;color:#337AB7">Mouse controls:</p>
      <span><p class="falselist">Left button hold and move: rotate camera around center.</p>
      <p class="falselist">Left button click: pick atom or distance.</p>
      <p class="falselist">Middle button hold and move: zoom camera in and out.</p>
      <p class="falselist">Middle button click: center camera on atom.</p>
      <p style="padding-left:15px" >Right button hold and move: translate camera in screen plane.</p></span>
            <!-- <p style="text-align: justify;">For more information about the viewer, visit the <a href="http://proteinformatics.charite.de/ngl/doc/index.html" target="_blank">NGL documentation</a>.</p>-->
         <p>For more information, see the <a href="{% url 'view:viewer_docs' %}" target="_blank" >docs</a>.
         </p>

     </div>
  </div>
</div> <!-- End page_info-->
<div class="row" id="viewer_and_analysis" style="height:100%;position: relative; overflow-y: auto; overflow-x: hidden;padding:12px 1px; top:-10px">
<div id="pprotform left_half" class="col-lg-6 " style="padding:0 7px"> 
  <div id="leftPanelID" class="col-md-12 panel panel-primary leftPannel" style="margin-bottom:10px;height:100%;position: relative; overflow-y: auto; overflow-x: hidden;"> 
    <div class="panel-body" style="padding-top:10px;margin-bottom:0;">

<!--      <div style="text-align:center">
                  <h4><br>GPCR visualizaion</h4>
                </div><br>   -->

        <div class="container-fluid" id="main_container">

        <div style="text-align:center;margin:5px 0 0 0;">
            <div class="row" id="VisualizationDiv" style="background-color:#F3F3F3; border-radius:2px;padding:5px;" data-bind_domain="{{bind_domain}}"  data-presel_pos="{{presel_pos}}">
                <h4 style="padding:0;margin:0;">GPCRmd Viewer
                </h4>
            </div>
        </div>

        <div style="margin:5px 0 5px 0;">
            <div class="row" style="padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;">

              {% if all_prot_names %}
                  {{all_prot_names}}
                  {% if pdbid %}
                    {% if pdbid == "HOMO" %}
                      (<span id="pdbid">Homology modeling</span>)
                    {% else %}
                      (<span id="pdbid">{{pdbid}}</span>)
                    {% endif %}
                  {% else %}
                    <span id="pdbid"></span>
                  {% endif %}
              {% else %}
                <span id="pdbid">
                {% if pdbid %}
                    {{pdbid}}
                {% endif %}
              </span>
              {% endif %}
              <a href="{% url 'dynadb:query_dynamics' dyn_id %}" target="_blank" class="btn btn-default btn-xs pull-right"><span class="glyphicon glyphicon-download-alt"></span> Simulation report and files</a>
            </div>
        </div>
 


<!-- ============= IFRAME =========== -->
            <span id="loading"><center ><img src="{% static 'view/images/loading-gear.gif' %}" style="width:50px;height:50px;margin-top:210px;position:absolute;z-index:10;margin-left:-25px"/></center></span>
            <div id="view_screen" class="row str_file" data-struc_file={{structure_file}} data-struc_file_id={{structure_file_id}} data-dyn_id={{dyn_id}} data-all_chains="{{all_chains}}" data-delta="{{delta}}" data-pdb_muts="{{pdb_muts}}" data-pdb_vars="{{pdb_vars}}" data-seg_li="{{seg_li}}" data-light_sel="{{light_sel}}" data-heavy_comp_sel="{{heavy_comp_sel}}" data-exception_light="{{exception_light}}" data-network_default="{% if network_def %}true{% else %}false{% endif %}" data-watervol_default="{% if watervol_def %}true{% else %}false{% endif %}" data-tunnels_channels_default="{% if tunnels_channels_def %}true{% else %}false{% endif %}"  data-ligprotint_default="{% if ligprotint_def %}true{% else %}false{% endif %}" data-pharmacophore_default="{% if pharmacophore_def %}true{% else %}false{% endif %}"  data-is_default_page="{% if is_default_page %}true{% else %}false{% endif %}" data-predef_int_data="{{predef_int_data}}">
                <div id="legend_row" class="row" style=max-width:620px;margin:auto>
                    <div id="legend" style="float:left;min-height:20px"> </div>
                    <!--button class="btn btn-danger btn-xs pull-right" style="margin:0;" type="button" id="clear_dist_reps">Clear distances</button>-->
                </div>  
                <span id="varinfo_par" ></span>
                <div >
                    <div id="dropdownAndIframe" style="margin:auto;position:relative;overflow-y:hidden;overflow-x:auto;height:445px;max-width:622px;margin-bottom:5px">
                    
                         {% if traj_list %}
                          <div id="trajsDropdown" class="dropdown showWhenNGLLoad" style="z-index:11;visibility:hidden">
                            <button id="selectedTraj" class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown" style="margin-left:3px;margin-top:7px;min-width:150px;text-align:left" data-tpath={{traj_list.0.0}} data-fplot_file="{{traj_list.0.3.1.2}}" data-test="{{traj_list.0.3.6}}" data-trajidtoframenum="{{trajidToFramenum}}" > 
                              <span class="pull-left">
                                <b>Trajectory ID:</b> <span id="selectedTraj_id">{{ traj_list.0.2 }}</span>
                                <span id="selectedTraj_note">
                                  {% if traj_list.0.4 %}
                                    ({{traj_list.0.4}})
                                  {% endif %}
                                </span>
                              </span>
                              <span class="caret pull-right" style="margin-top:7px"></span>
                            </button>
                            <ul class="dropdown-menu" style="height: auto;max-height:350px;overflow-x: hidden;padding:0">
                              <li class="traj_element tsel" style="padding:5px 10px 5px 10px;background-color:#FFF7F7" id="traj_id_{{traj_list.0.2}}" data-tpath={{traj_list.0.0}} data-fplot_file="{{traj_list.0.3.1.2}}"  
                              {% for e in traj_list.0.3 %}
                                data-{{e.0}}="{{e.2}}"
                              {% endfor %}
                              {% if traj_list.0.4 %}
                                data-trajcomment="{{traj_list.0.4}}"
                              {% endif %}
                              >Trajectory {{traj_list.0.2}}
                              {% if traj_list.0.4 %}
                                ({{traj_list.0.4}})
                              {% endif %}
                            </li>
                            {% for traj in traj_list|slice:"1:" %}
                              <li class="traj_element" style="padding:5px 10px 5px 10px;" id="traj_id_{{traj.2}}" data-tpath={{traj.0}} data-fplot_file={{traj.3.0.2}} 
                              {% for e in traj.3 %}
                                data-{{e.0}}="{{e.2}}"
                              {% endfor %}
                              {% if traj.4 %}
                                data-trajcomment="{{traj.4}}"
                              {% endif %}
                              >Trajectory {{traj.2}}
                                {% if traj.4 %}
                                  ({{traj.4}})
                                {% endif %}
                              </li>
                            {% endfor %}
                            </ul>
                          </div>
                         {% endif %}
                         
                        <div class="dropdown" style="z-index:10">
                            <button id="onclicksel" class="btn btn-default btn-xs dropdown-toggle showWhenNGLLoad" type="button" data-toggle="dropdown" aria-expanded="false" style="margin-left:3px;margin-top:7px;min-width:150px;text-align:left;visibility:hidden">
                              <span class="pull-left">
                                <b>On click mode: </b> 
                                <span id="onclickbtntext">dists.</span>
                              </span>
                              <span class="caret pull-right" style="margin-top:7px"></span></button>
                            <ul id="onclickshowdropd" class="dropdown-menu" style="height: auto;padding:0">
                              <li id="showdists" style="padding:5px 10px 5px 10px;background-color:#FFF7F7" title="Click a pair of residues to show the distance betweent them."  class="onclickshow is_active" data-short="dists" >Distances</li>
                              {% if pdb_vars|length > 2 %}
                                <li id="showvars" style="padding:5px 10px 5px 10px;" data-short="vars" title="Display known variants of the residue clicked." class="onclickshow" >Variants</li>
                              {% else %}
                                <li style="padding:5px 10px 5px 10px;color:#a6a6a6;cursor:not-allowed" title="No variants found."  >Variants</li>
                              {% endif %}
                              {% if pdb_muts|length > 2 %}
                                <li id="showmuts" style="padding:5px 10px 5px 10px;" data-short="muts" title="Display information on experimental mutation of the residue clicked." class="onclickshow" >Mutations
                                </li>
                              {% else %}
                                <li style="padding:5px 10px 5px 10px;color:#a6a6a6;cursor:not-allowed" title="No mutations found."  >Mutations</li>
                              {% endif %}
                              <li id="shownone" style="padding:5px 10px 5px 10px;"  class="onclickshow" data-short="none" >None</li>

                            </ul>
                          </div>
                         
                         
                        <iframe style="border:none;position:absolute;top:-30px;" id="embed_mdsrv" data-mdsrv_url={{mdsrv_url}} src="{{mdsrv_url}}/html/embed.html" scrolling="no" height="1000px" width="620px"></iframe>
                    </div>

                </div>          
            </div>            
           
            <div id="speed_warnings" class="row" data-warning_load="{{warning_load}}">
              <div id="speed_warnings_light">
              </div>
              <div id="speed_warnings_heavy">
              </div>
            </div>
<!-- ============= Apply buttonss =========== -->
            <div style="margin-bottom:5px">
<!--                <div class="row" style="margin-top:5px;margin-bottom:10px;" >
                     <div style="padding-right:3px;padding-left:3px">
                     <p style='text-align:right;color:#808080'>Visualization and trajectory sharing powered by <a href="http://nglviewer.org/ngl/api/index.html" rel="noreferrer" target="_blank">NGL viewer</a> and <a href="http://nglviewer.org/mdsrv/" rel="noreferrer" target="_blank">MDSrv</a></p>
                    </div>
                 </div>-->
                 <div class="row" style="margin-top:5px;margin-bottom:10px;" >
                   <div style="padding-right:3px;padding-left:3px"> 
                      <!--<button  class="btn btn-success" id="submit" >Apply</button> -->
                      <button  class="btn btn-danger btn-xs" id="clearAll" style="margin-top:5px">Clear All</button>
                                           
                      <div class="pull-right">
                          <!--
                          <button id="center" class="btn btn-default" type="button" style="padding-right:7px;padding-left:7px;height:35px" >Center</button>
                          <div class="btn-group">
                            <button type="button" id="bckg_dark" class="btn btn-default bckg_theme" style="padding-left:5px;padding-right:5px">Dark</button>
                            <button type="button" id="bckg_light" class="btn btn-default bckg_theme active" style="padding-left:5px;padding-right:5px">Light</button>
                          </div>                      
                          <button class="btn btn-default" type="button" id="screenshot"  style="font-size:12px;padding-right:7px;padding-left:7px;height:35px" ><span class="glyphicon glyphicon-camera" style="margin-right:5px"></span>Screenshot</button>
                          -->
                                
                          
                          
                          <button id="restartPos" type="button" class="btn btn-link settingsB" title="Reset position" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-repeat"></span></button>       
                          <button id="center" type="button" class="btn btn-link settingsB" title="Center" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-record"></span></button>
                          <button id="background" type="button" class="btn btn-link settingsB light" title="Dark background" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-adjust"></span></button>
                          <button id="screenshot" type="button" class="btn btn-link settingsB" title="Take screenshot" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-camera"></span></button>                                    
                        <!--  <a id="to_mdsrv" class="settingsB" href="{{mdsrv_url}}/html/mdsrv_emb.html" target="_blank" style="padding:7px;color:#585858" title="Advanced visualization"><span class="glyphicon glyphicon-cog"></span></a>-->
                        <a id="to_mdsrv" class="btn btn-link settingsB" href="{{mdsrv_url}}/html/mdsrv_emb.html" target="_blank" style="padding:7px;color:#585858" title="Advanced visualization"><span class="glyphicon glyphicon-cog"></span></a>
                        
                          <div  id="moreSettings_div" class="dropdown displaydrop pull-right" >
                            <button id="moreSettings" type="button" class="btn btn-link settingsB dropbtn_opt" title="More setting options" style="padding:7px;color:#585858"><span class="glyphicon glyphicon-plus-sign"></span></button>
                            <div class="dropdown-content" style="padding: 7px; background-color: white; width: 252px; display: block; border: 1px solid #808080; border-radius:2px;display:none;left:-222px">
                                  

                                    <div style="margin-bottom:10px;">
                                        Show H atoms 
                                         <div class="btn-group btn-group-xs">
                                          <button type="button" id="showHOn" class="btn btn-default showHSet" style="padding:2px 5px 2px 5px;">On</button>
                                          <button type="button" id="showHOff" class="btn btn-default active showHSet" style="padding:2px 5px 2px 5px;">Off</button>
                                        </div> 
                                    </div>                                  
                                    <div style="margin-bottom:10px;">
                                        Projection 
                                         <div class="btn-group btn-group-xs">
                                          <button type="button" id="projOrtho" class="btn btn-default projectionOP" style="padding:2px 5px 2px 5px;width:85px">Orthographic</button>
                                          <button type="button" id="projPersp" class="btn btn-default active projectionOP" style="padding:2px 5px 2px 5px;width:85px">Perspective</button>
                                        </div> 
                                    </div>
                                    <div style="margin-bottom:10px;">
                                        Spin 
                                         <div class="btn-group btn-group-xs">
                                          <button type="button" id="spinOn" class="btn btn-default spinSet" style="padding:2px 5px 2px 5px;">On</button>
                                          <button type="button" id="spinOff" class="btn btn-default active spinSet" style="padding:2px 5px 2px 5px;">Off</button>
                                        </div> 
                                    </div>
                                    <div style="margin-bottom:10px;">
                                        Trajectory step size: <input class="form-control input-sm rvSpaces" id="trajStep"  type="number" placeholder=3 style="width:50px;padding-left:7px;padding-right:2px;">
                                    </div>
                                    <div style="margin-bottom:10px;">
                                        Trajectory timeout: <input class="form-control input-sm rvSpaces" id="trajTimeOut"  type="number" placeholder=50 style="width:50px;padding-left:7px;padding-right:2px;"> ms
                                    </div>
                                    
                                    <div >
                                        Interpolation type: 
                                            <select id="trajIntType" name="trajIntTypeNm">
                                                <option   value="spline">spline</option> 
                                                <option   value="linear">linear</option>
                                                <option  selected value="">none</option>
                                            </select>    
                                    </div>

                                  
                            </div>
                          </div>
   
                      </div>
                   </div>
              </div>
             </div>
             
             
        <div style="text-align:center;margin:0;">
            <div class="row" style="background-color:#F3F3F3; border-radius:2px;padding:5px;">
                <h4 style="padding:0;margin:0;">Selection
                </h4>
                <span id="selectionDiv"></span><span id="EDselectionDiv"></span>
            </div>
        </div>
        <div id ="allSelTools" style="margin-bottom:30px">

          <div id="strucSel" style="margin-bottom:5px">
            <div class="row" style="margin-top:10px;">
                <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:3px solid #999999;border-radius:0;text-align:center;font-size:16px" data-toggle="collapse" data-target="#strucSel_opt"><span>Structure selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-up arrow"></span></div> 
            </div>
            <div id="strucSel_opt" class="collapse in" style="padding-left:15px;">


      <!-- ============= Comp buttonss =========== -->
              <div id="quicksel_all" style="margin-bottom:5px">
                  <div class="row" style="margin-top:5px;">
                      <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#quicksel"><span>Quick selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 
                  </div>
                  <div id="quicksel" class="collapse" style="padding-right:15px;">


                      <div class="row" style="margin-top:10px;margin-bottom:10px"><center>
                          <button title="{{chains}}" style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default receptor active nglCallBtn changefocus"  id="receptor">Receptor</button>
                          <!--{% if other_prots%}
                            <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default rep_elements nonGPCR nglCallBtn changefocus" title="{{other_prots.1}}" id="{{other_prots.0}}" >Other proteins</button>
                          {% endif %}-->
                          {% for long_n, short_n, ctype, load_heavy_tag in compounds %}
                              {% if ctype == "Ligand" %}
                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default rep_elements comp nglCallBtn active changefocus {{ctype}}" title="{{short_n}}" id="{{short_n}}" data-comptype="{{ctype}}" >{{long_n}}</button>
                              {% elif ctype == "Prot_ligand" %}

                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default rep_elements nonGPCR nglCallBtn active changefocus" title="Chain {{short_n}}" data-selector="{{short_n}}" >{{long_n}}</button>

                              {% else %}
                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default rep_elements comp nglCallBtn changefocus {{load_heavy_tag}}" title="{{short_n}}" id="{{short_n}}" data-comptype="{{ctype}}" >{{long_n}}</button>
                              {% endif %}
                          {% endfor %}
                          {% if ligands_short %}
                              <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default rep_elements changefocus" title="GPCR residues within 2.5 Angstrom of ligand" id="bindingSite" data-ligli="{{ligands_short}}" >Binding site</button>
                          {% endif %}
                          {% if compounds|length > 1%}
                          <button  class="btn btn-default nglCallBtn changefocus" id="btn_all" style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px">All</button>
                          <button  class="btn btn-link nglCallBtn" id="btn_clear" style="color:#DC143C;margin-bottom:10px;margin-right:3px;margin-left:3px;padding:5px 5px 5px 5px;">Clear</button>
                          {% endif %}
                      </center></div>
                      
                      <center>
                        <div style="height:1px;background-color:lightgrey;width:90%"></div>
                      </center>
                      
                    <!-- -->
                    {% if TMsel_all %}
                    <div class="row" style="margin-top:15px;margin-bottom:10px">
                      <center >
                      {% for tmname, tmsel in TMsel_all %} 
                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;padding:5px 10px 5px 10px;" class="btn btn-default changefocus clickUnclick tmsel"  id="quick_{{tmname}}" data-tmsel="{{tmsel}}">{{tmname}}</button>
                      {% endfor %}
                      <button id="btn_clear_tms" class="btn btn-link" style="color:#DC143C;margin-bottom:10px;margin-right:3px;margin-left:3px;padding:5px 5px 5px 5px;">Clear</button>
                      </center>
                    </div>
                    <center>
                      <div style="height:1px;background-color:lightgrey;width:90%"></div>
                    </center>
                    {% endif %}
                    <!-- -->
                     <div class="row" style="margin-top:15px">
                     
                      <div class="sel_within" style="padding-left:5px;margin-right:5px;margin-left:0;margin-bottom:10px;">
                        <div class="dist_sel" id="row0" style="margin-bottom:5px">
                          <span class="tick" ></span>
                          <span class="always" style="margin-left:14px">
                           Show 
                              <select class="resWthComp nglCallChangeWth" name="rescomp">
                                  <option  selected value="protein">residues</option> <!-- This can be improved by considering the case of multiple proteins: add option for each prot at this sel.-->
                                 {% for long_n, short_n, ctype, load_heavy_tag in compounds %}
                                      <option   value="{{short_n}}" class="{{load_heavy_tag}}">{{long_n}}</option>
                                 {% endfor %}
                              </select>                     
                            within 
                          <input class="form-control input-sm inputdist nglCallChangeWth" type="text" style="width:40px;padding-left:7px;">
                            &#8491; of
                              <select class="wthComp" name="comp">
                                 {% for long_n, short_n, ctype, load_heavy_tag in compounds %}
                                 <option  value="{{short_n}}">{{long_n}}</option>
                                 {% endfor %}
                                 <!--{% if other_prots%}
                                 <option   value="{{other_prots.0}}">Other proteins</option>
                                 {% endif %}-->
                                 <option   value="user_sel">Selection</option>
                              </select>
                              <span class="user_sel_input_p"></span>
                              <button class="btn btn-link rm_btn" style="color:#DC143C;font-size:20px;margin:0;padding:0;" ><span class="glyphicon glyphicon-remove-sign"></span></button>
                              <button class="btn btn-link add_btn" style="color:#57C857;font-size:20px;margin:0;padding:0" ><span class="glyphicon glyphicon-plus-sign"></span></button>
                          </span>
                          <div class="alert_sel_wth"><div class="alert_sel_wth_gnum"></div><div class="alert_sel_wth_ngl"></div></div>
                        </div>
                        <!--<span id="show_within"></span>-->
                      </div>
                      
                     </div>
                     <!--<div style="margin-left:18px">
                         <div class="row">
                           <input class="updateSelOrNot" type="radio" checked value="updateTrue" name="updateSelOrNot"> 
                            Update selection at each frame
                         </div>
                         <div class="row">
                           <input class="updateSelOrNot" type="radio" value="updateFalse" name="updateSelOrNot"> 
                            Restrict selection at frame 
                              <input type="number" style="width:50px;padding-left:7px;padding-right:2px;"  id="distSelFr" class="form-control input-sm rvSpaces">
                            of trajectory
                                  <select id="" name="distSel_traj">
                                     {% for traj in traj_list %}
                                     <option class="distSel_traj" name="{{traj.0}}" value="{{traj.2}}">{{traj.1}}</option>
                                     {% endfor %}
                                  </select>
                            
                         </div>
                     </div>-->
                     
                  </div>
              </div>
      <!-- ============= Input selection =========== -->
                  <div id="selection_all" style="margin-bottom:5px;margin-top:5px">
                  <div class="row">
                      <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#selection"><span>Custom selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 
                  </div>
                  <div id="selection" class="collapse" style="padding-right:15px;">
                    <div class="info_text" style="margin-top:10px;margin-bottom:15px;">
                    Input your selection using the <a href="http://nglviewer.org/ngl/api/manual/usage/selection-language.html" target="_blank">NGL selection language</a>. Generic GPCR residue numbering can also be used (more info <a href="/view/docs/#customsel" target="_blank">here</a>).
                    </div>
                     <!--<div style="margin:15px 0 20px 15px;">
                      <label class="checkbox" style="margin:0;font-weight:normal;width:220px">
                        <input  type="checkbox" id="load_heavy_textinput" class="check_trigger_ngl" style="top:-3px;"> Include membrane and water 
                        <span title="Check this box to include water and membrane molecules. This may cause a slow-down of the trajectory playback speed." class="structuresel_tooltip glyphicon glyphicon-exclamation-sign" data-toggle="tooltip" style="cursor: default;font-size:12px" ></span>
                      </label>
                     </div>-->
                   <div class="gpcr_pdb" style="padding-left:15px" data-gpcr_pdb ="{{gpcr_pdb}}" >
                     <div id="text_input_all"  style="margin-top:10px;">
                          <div  class="text_input" id="ti_row0" style="margin-bottom:5px">
                             <div  class="row">
                                <div class="col-sm-10 ti_left" style="padding-right:3px;padding-left:3px"> 
                                <input type="text" value="" class="form-control sel_input nglCallChange" placeholder="Specify your selection (e.g.: 6.50 3.32" style="width:100%;background-color:#F8F8F8">
                                <div class="pull-right" style="padding:0;margin:0;font-size:12px">
                                     <div style="float:left;height:27px" >
                                          <select class="high_type nglCallChangeTI" name="high_type0" style="padding:0;font-size:12px;height:24px;margin: 3px 0 0 0">
                                             <option value="licorice">Licorice</option>
                                             <option value="ball+stick">Ball+stick</option>
                                             <option value="hyperball">Hyperball</option>
                                             <option value="line">Line</option>
                                             <option value="spacefill">Spacefill</option>
                                             <option value="cartoon">Cartoon</option>
                                             <option value="ribbon">Ribbon</option>
                                             <option value="rope">Rope</option>
                                             <option value="tube">Tube</option>
                                             <!--<option value="axes">Axes</option>-->
                                          </select>
                                          <select class="high_scheme nglCallChangeTI" name="high_scheme0" style="padding:0;font-size:12px;width:90px;height:24px;margin: 3px 0 0 0">
                                             <option value="element">Element</option>
                                             <option value="uniform">Uniform</option>
                                             <option value="chainid">Chain</option>
                                             <option value="moleculetype">Molecule type</option>
                                             <option value="sstruc">Structure</option>
                                             <option value="resname">Residue name</option>
                                             <option value="residueindex">Residue index</option>
                                             <option value="hydrophobicity">Hydrophobicity</option>
                                             {% if seg_li %}
                                             <option value="FPscheme">GPCR Helices</option>
                                             {% endif %}
                                          </select>
                                        </div>
                                        <div class="dropdown displaydrop" style="float:left;height:27px;margin:3px 0 0 0;padding:0">
                                          <button class="dropbtn" style="margin-top: 7px; margin-left: 3px;" data-color="#00d215"></button> 
                                          <div class="dropdown-content" style="margin-left:3px">
                                                <div class="dropcolor nglCallClickTI" style="background-color:#3193ff;width:16px; height: 16px;" data-color="#3193ff"></div>
                                                <div class="dropcolor nglCallClickTI" style="background-color:#B3072F;width:16px; height: 16px;" data-color="#B3072F"></div>
                                                <div class="dropcolor nglCallClickTI" style="background-color:#ff4c00;width:16px; height: 16px;" data-color="#ff4c00"></div>
                                                <div class="dropcolor nglCallClickTI" style="background-color:#c5c5c5;width:16px; height: 16px;" data-color="#c5c5c5"></div>
                                                <div style="background-color:white;width:16px; height: 16px;border:1px solid #808080;" class="dropcolor morecolors nglCallClickTI" data-color="#FFFFFF"><span class="glyphicon glyphicon-plus-sign" style="color:#696969;padding-left:1px"></span></div>
                                          </div>
                                        </div>
                                        <span class="span_morecolors displaydrop" style="float:left" ></span><!--   <input type="text" style="width:50px;padding-left:3px;padding-right:3px;height:22px;margin-top:2px;margin-bottom:0;font-size:12px" placeholder="#FFFFFF" class="form-control input-sm input_dd_color">
       -->
                               </div>
                                </div>
                                <div class="col-sm-2 radio" style="padding-right:0;padding-left:0;margin-top:7px;width:48px;text-align: center">
                                      <button class="btn btn-link ti_rm_btn" style="color:#DC143C;font-size:20px;margin:0;padding:0;"><span class="glyphicon glyphicon-remove-sign"></span></button>
                                      <button class="btn btn-link ti_add_btn" style="color:#57C857;font-size:20px;margin:0;padding:0"><span class="glyphicon glyphicon-plus-sign"></span></button>
                                </div>
                            </div>
                            <div class="ti_alert"><div class="ti_alert_gnum"></div><div class="ti_alert_ngl"></div></div>      
                        </div>
                    </div>

                   </div>
                  </div>
                  </div>
      <!-- ============= Sequence selection =========== -->
      {% if prot_seq_pos %}
                  <div id="seqselection_all" style="margin-bottom:5px;margin-top:5px">
                  <div class="row">
                      <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#seqselection"><span>Sequence selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 
                  </div>
                  <div id="seqselection" class="collapse" style="padding-right:15px;">


                   <div  style="padding-left:15px;margin-top:10px;" >
                   
                     <div id="seq_input_all"  style="display:none">
                          <div  class="seq_input_row" id="si_row0" style="margin-bottom:5px">
                             <div  class="row">
                                <div class="col-sm-11 si_left" style="padding-right:3px;padding-left:3px"> 
                                <input type="text" value="" class="form-control seq_input nglCallChange" placeholder="Specify your selection" style="width:100%;background-color:#F8F8F8">
                                <div class="pull-right" style="padding:0;margin:0;font-size:12px">
                                     <div style="float:left;height:27px" >
                                          <select class="high_type nglCallChangeTI" name="high_type0" style="padding:0;font-size:12px;height:24px;margin: 3px 0 0 0">
                                             <option value="licorice">Licorice</option>
                                             <option value="ball+stick">Ball+stick</option>
                                             <option value="hyperball">Hyperball</option>
                                             <option value="line">Line</option>
                                             <option value="spacefill">Spacefill</option>
                                             <option value="cartoon">Cartoon</option>
                                             <option value="ribbon">Ribbon</option>
                                             <option value="rope">Rope</option>
                                             <option value="tube">Tube</option>
                                             <!--<option value="axes">Axes</option>-->
                                          </select>
                                          <select class="high_scheme nglCallChangeTI" name="high_scheme0" style="padding:0;font-size:12px;width:90px;height:24px;margin: 3px 0 0 0">
                                             <option value="element">Element</option>
                                             <option value="uniform">Uniform</option>
                                             <option value="chainid">Chain</option>
                                             <option value="moleculetype">Molecule type</option>
                                             <option value="sstruc">Structure</option>
                                             <option value="resname">Residue name</option>
                                             <option value="residueindex">Residue index</option>
                                             <option value="hydrophobicity">Hydrophobicity</option>
                                             {% if seg_li %}
                                             <option value="FPscheme">GPCR Helices</option>
                                             {% endif %}
                                          </select>
                                        </div>
                                        <div class="dropdown displaydrop" style="float:left;height:27px;margin:3px 0 0 0;padding:0">
                                          <button class="dropbtn" style="margin-top: 7px; margin-left: 3px;" data-color="#00d215" ></button> 
                                          <div class="dropdown-content" style="margin-left:3px">
                                                <div class="dropcolor nglCallClickTI" style="background-color:#3193ff;width:16px; height: 16px;" data-color="#3193ff"></div>
                                                <div class="dropcolor nglCallClickTI" style="background-color:#B3072F;width:16px; height: 16px;" data-color="#B3072F"></div>
                                <div class="dropcolor nglCallClickTI" style="background-color:#ff4c00;width:16px; height: 16px;" data-color="#ff4c00"></div>
                                <div class="dropcolor nglCallClickTI" style="background-color:#c5c5c5;width:16px; height: 16px;" data-color="#c5c5c5"></div>
                                <div style="background-color:white;width:16px; height: 16px;border:1px solid #808080;" class="dropcolor morecolors nglCallClickTI" data-color="#FFFFFF"><span class="glyphicon glyphicon-plus-sign" style="color:#696969;padding-left:1px"></span></div>
                                          </div>
                                        </div>
                                        <span class="span_morecolors displaydrop" style="float:left" ></span><!--   <input type="text" style="width:50px;padding-left:3px;padding-right:3px;height:22px;margin-top:2px;margin-bottom:0;font-size:12px" placeholder="#FFFFFF" class="form-control input-sm input_dd_color">
       -->
                               </div>
                                </div>
                                <div class="col-sm-1 radio" style="padding-right:0;padding-left:0;margin-top:7px;width:48px;text-align: center">
                                      <button class="btn btn-link si_rm_btn" style="color:#DC143C;font-size:20px;margin:0;padding:0;"><span class="glyphicon glyphicon-remove-sign"></span></button>
                                      <button class="btn btn-link si_add_btn" style="color:#57C857;font-size:20px;margin:0;padding:0"><span class="glyphicon glyphicon-plus-sign"></span></button>
                                </div>
                            </div>
                            <div class="si_alert"><div class="si_alert_gnum"></div><div class="si_alert_ngl"></div></div>      
                        </div>
                    </div>

                    
                    <div style="margin-bottom:20px" class="row">

                    <div id="seq_sel_div" style="padding:5px;border:1px solid #F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                      <!--<button  class="btn btn-link" id="addToSel" type="button" style="padding:0 0 0 10px;display:none"><span id="addToSelHov" class="glyphicon glyphicon-ok" style="color:#5CB85C"> Confirm selection</button>-->
                      <button style="display:none" type="button" id="addToSel" class="btn btn-success btn-xs hideIfNone" data-toggle="popover" data-placement="right" data-content="Click to apply." data-trigger="manual"><span style="font-size: 10px;" class="glyphicon glyphicon-ok" ></span> Confirm selection</button>
                    
                      <div class="row" style="margin:10px;width:auto;height:250px;overflow:auto;">
                        {% for prot_name, seq_pos in prot_seq_pos %}
                          <div style="clear: left;padding-bottom:20px">
                            {% if prot_seq_pos|length > 1 %}
                               <div>{{prot_name}}</div>
                            {% endif %}
                            {% for seq,pos,gnum,chain,index in seq_pos %}
                            <div id="{{index}}" title="{{gnum}}" class="seq_sel" style="cursor:pointer;float: left;text-align:center;font-size:10px;margin-bottom:5px;background-color:#f2f2f2">
                              <div id="ss_seq" style="clear: left;border:1px solid #E8E8E8; ;width:25px;height:15px">{{seq}}</div>
                              <div id="ss_pos" class="{{chain}}" style="clear: left;border:1px solid #E8E8E8 ;width:25px;height:15px">{{pos}}</div>
                            </div>            
                            {% endfor %}
                          </div>
                        {% endfor %}
                      </div> 
                    </div>
                    </div>
                    
                    
                   </div>
                  </div>
                  </div>

             {% endif %}
      <!-- ============= Predefined views of cons pos =========== -->
                 {% if gpcr_pdb != "no" %}
                  <div id="cons_pos_box_all" data-gpcr_id_name="{{gpcr_id_name_js}}" style="margin-top:5px;margin-bottom:5px">
                  <div class="row">
                      <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#cons_pos_box"><span>GPCR conserved positions </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div>               
                      <!--<button style="background-color:#ffffff;text-align:left;border-bottom:2px solid blue;border-radius:0"  type="button" class="btn btn-block" data-toggle="collapse" data-target="#cons_pos_box">GPCR conserved positions</button>-->
                  </div>
                  <div  class="collapse cons_pos_section" id="cons_pos_box" style="padding-right:15px;padding-left:15px;padding-top:10">
                    {% if gpcr_id_name|length > 1 %}
                      <div class="row" style="margin-bottom:10px">
                            <select class="form-control gpcr_sel" style="width:100%;height:32px;" >
                              <option value="all">All GPCRs</option>
                              {% for gpcr_id, prot_name in gpcr_id_name.items %}
                              <option value="{{gpcr_id}}">{{prot_name}}</option>
                              {% endfor %}
                            </select>
                      </div>
                      <!-- Conserved pos for all GPCRs -->
                          <div  class="gpcr_prot_show_cons gpcr_id_all" style="display:inline">
                              <ul class="nav nav-tabs" id="allclasses">
                                <li class="GPCRclass {{cons_pos_all_info.2.A.0}} cons_nav" data-TF="{{cons_pos_all_info.1.A}}"><a data-TF="{{cons_pos_all_info.1.A}}" class="cons_nav" data-toggle="tab" href="#classA_all">Class A</a></li>
                                <li class="GPCRclass {{cons_pos_all_info.2.B.0}} cons_nav" data-TF="{{cons_pos_all_info.1.B}}"><a data-TF="{{cons_pos_all_info.1.B}}" class="cons_nav" data-toggle="tab" href="#classB_all">Class B</a></li>
                                <li class="GPCRclass {{cons_pos_all_info.2.C.0}} cons_nav" data-TF="{{cons_pos_all_info.1.C}}"><a data-TF="{{cons_pos_all_info.1.C}}" class="cons_nav" data-toggle="tab" href="#classC_all">Class C</a></li>
                                <li class="GPCRclass {{cons_pos_all_info.2.F.0}} cons_nav" data-TF="{{cons_pos_all_info.1..F}}"><a data-TF="{{cons_pos_all_info.1..F}}" class="cons_nav" data-toggle="tab" href="#classF_all">Class F</a></li>
                              </ul>
                              <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                                  <div style="margin:0;" id="classA_all" class="tab-pane {{cons_pos_all_info.2.A.1}}">
                                      {% if cons_pos_all_info.1.A %}
                                          {% if cons_pos_all_info.0.A.1 %}
                                              <p>Highly conserved residues and motifs</p>
                                                {% for pos in cons_pos_all_info.0.A.1 %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                                {% for pos in motifs_all_info.A %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                          {% if cons_pos_all_info.0.A.0 %}
                                              <p>Most conserved residues</p>
                                                {% for pos in cons_pos_all_info.0.A.0 %}
                                                 <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd high_pdA btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                      {% endif %}
                                  </div>
                                  <div id="classB_all" class="tab-pane {{cons_pos_all_info.2.B.1}}">
                                        {% if cons_pos_all_info.0.B.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_pos_all_info.0.B.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdB btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}   
                                        {% endif %}                         
                                  </div>  
                                  <div id="classC_all" class="tab-pane {{cons_pos_all_info.2.C.1}}">
                                        {% if cons_pos_all_info.0.C.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_pos_all_info.0.C.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdC btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>  
                                  <div id="classF_all" class="tab-pane {{cons_pos_all_info.2.F.1}}">
                                        {% if cons_pos_all_info.0.F.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_pos_all_info.0.F.0 %}
                                        <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdF btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>


                                 <div style="float:left;height:27px" >
                                      Representation:
                                      <select class="conspos_style_sel updateSelOrNot" name="conspos_style" style="padding:0;font-size:12px;height:24px;margin: 3px 0 0 0">
                                         <option value="spacefill">Spacefill</option>
                                         <option value="licorice">Licorice</option>
                                         <option value="ball+stick">Ball+stick</option>
                                         <option value="hyperball">Hyperball</option>
                                         <option value="line">Line</option>
                                         <!--<option value="axes">Axes</option>-->
                                      </select>
                                  </div>

                                  <button class="btn btn-link pull-right clear_conspos" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear</button>
                             </div>
                          </div>
                      <!-- Conserved pos for each of the GPCRs -->
                      {% for gpcr_id, gpcr_name, show_class,active_class, cons_class, motifs_def in all_gpcrs_info %}            
                          <div  class="gpcr_prot_show_cons gpcr_id_{{gpcr_id}}" style="display:none">
                              <ul class="nav nav-tabs" id="allclasses">
                                <li class="GPCRclass {{active_class.A.0}} cons_nav" data-TF="{{show_class.A}}"><a data-TF="{{show_class.A}}" class="cons_nav" data-toggle="tab" href="#classA_{{gpcr_id}}">Class A</a></li>
                                <li class="GPCRclass {{active_class.B.0}} cons_nav" data-TF="{{show_class.B}}"><a data-TF="{{show_class.B}}" class="cons_nav" data-toggle="tab" href="#classB_{{gpcr_id}}">Class B</a></li>
                                <li class="GPCRclass {{active_class.C.0}} cons_nav" data-TF="{{show_class.C}}"><a data-TF="{{show_class.C}}" class="cons_nav" data-toggle="tab" href="#classC_{{gpcr_id}}">Class C</a></li>
                                <li class="GPCRclass {{active_class.F.0}} cons_nav" data-TF="{{show_class.F}}"><a data-TF="{{show_class.F}}" class="cons_nav" data-toggle="tab" href="#classF_{{gpcr_id}}">Class F</a></li>
                              </ul>
                              <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                                  <div style="margin:0;" id="classA_{{gpcr_id}}" class="tab-pane {{active_class.A.1}}">
                                      {% if show_class.A %}
                                          {% if cons_class.A.1 %}
                                              <p>Highly conserved residues and motifs</p>
                                                {% for pos in cons_class.A.1 %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                                {% for pos in motifs_def.A %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                          {% if cons_class.A.0 %}
                                              <p>Most conserved residues</p>
                                                {% for pos in cons_class.A.0 %}
                                                 <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd high_pdA btn btn-default changefocus"  data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                      {% endif %}
                                  </div>
                                  <div id="classB_{{gpcr_id}}" class="tab-pane {{active_class.B.1}}">
                                        {% if cons_class.B.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.B.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdB btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}   
                                        {% endif %}                         
                                  </div>  
                                  <div id="classC_{{gpcr_id}}" class="tab-pane {{active_class.C.1}}">
                                        {% if cons_class.C.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.C.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdC btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>  
                                  <div id="classF_{{gpcr_id}}" class="tab-pane {{active_class.F.1}}">
                                        {% if cons_class.F.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.F.0 %}
                                        <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdF btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>
                                 <div style="float:left;height:27px" >
                                      Representation:
                                      <select class="conspos_style_sel updateSelOrNot" name="conspos_style" style="padding:0;font-size:12px;height:24px;margin: 3px 0 0 0">
                                         <option value="spacefill">Spacefill</option>
                                         <option value="licorice">Licorice</option>
                                         <option value="ball+stick">Ball+stick</option>
                                         <option value="hyperball">Hyperball</option>
                                         <option value="line">Line</option>
                                         <!--<option value="axes">Axes</option>-->
                                      </select>
                                  </div>
                                  <button class="btn btn-link pull-right clear_conspos" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear</button>
                             </div>
                          </div>
                      {% endfor %}
                     {% else %} <!-- When only 1 gpcr: -->
                         {% for gpcr_id, gpcr_name, show_class,active_class, cons_class, motifs_def in all_gpcrs_info %}            
                          <div  class="gpcr_prot_show_cons gpcr_id_{{gpcr_id}}">
                              <ul class="nav nav-tabs" id="allclasses">
                                <li class="GPCRclass {{active_class.A.0}} cons_nav" data-TF="{{show_class.A}}"><a data-TF="{{show_class.A}}" class="cons_nav" data-toggle="tab" href="#classA"> Class A</a></li>
                                <li class="GPCRclass {{active_class.B.0}} cons_nav" data-TF="{{show_class.B}}"><a data-TF="{{show_class.B}}" class="cons_nav" data-toggle="tab" href="#classB">Class B</a></li>
                                <li class="GPCRclass {{active_class.C.0}} cons_nav" data-TF="{{show_class.C}}"><a data-TF="{{show_class.C}}" class="cons_nav" data-toggle="tab" href="#classC">Class C</a></li>
                                <li class="GPCRclass {{active_class.F.0}} cons_nav" data-TF="{{show_class.F}}"><a data-TF="{{show_class.F}}" class="cons_nav" data-toggle="tab" href="#classF">Class F</a></li>
                              </ul>
                              <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                                  <div style="margin:0;" id="classA" class="tab-pane {{active_class.A.1}}">
                                      {% if show_class.A %}
                                          {% if cons_class.A.1 %}
                                              <p>Highly conserved residues and motifs</p>
                                                {% for pos in cons_class.A.1 %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                                {% for pos in motifs_def.A %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd high_pdA btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                          {% if cons_class.A.0 %}
                                              <p>Most conserved residues</p>
                                                {% for pos in cons_class.A.0 %}
                                                 <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd high_pdA btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                      {% endif %}
                                  </div>
                                  <div id="classB" class="tab-pane {{active_class.B.1}}">
                                        {% if cons_class.B.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.B.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdB btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}   
                                        {% endif %}                         
                                  </div>  
                                  <div id="classC" class="tab-pane {{active_class.C.1}}">
                                        {% if cons_class.C.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.C.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdC btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>  
                                  <div id="classF" class="tab-pane {{active_class.F.1}}">
                                        {% if cons_class.F.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.F.0 %}
                                        <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd high_pdF btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>

                                 <div style="float:left;height:27px" >
                                      Representation:
                                      <select class="conspos_style_sel updateSelOrNot" name="conspos_style" style="padding:0;font-size:12px;height:24px;margin: 3px 0 0 0">
                                         <option value="spacefill">Spacefill</option>
                                         <option value="licorice">Licorice</option>
                                         <option value="ball+stick">Ball+stick</option>
                                         <option value="hyperball">Hyperball</option>
                                         <option value="line">Line</option>
                                         <!--<option value="axes">Axes</option>-->
                                      </select>
                                  </div>

                                  <button class="btn btn-link pull-right clear_conspos" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear</button>
                             </div>
                          </div>
                         {% endfor %}
                     {% endif %}
                  </div>
                  </div>
                  {% endif %}
              </div>
          </div> <!-- end strucSel -->

          {% if ed_mats and pdbid %}
          <!--<div id="edSel" style="margin-bottom:5px" data-r_angl="{{ed_align_matrix.0}}" data-transl="{{ed_align_matrix.1}}">-->
          <div id="edSel" style="margin-bottom:5px" data-r_angl="{{ed_align_matrix.0}}" data-trajmat_dict="{{ed_mats}}">
            <div class="row" style="margin-top:15px;">
                <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:3px solid #999999;border-radius:0;text-align:center;font-size:16px" data-toggle="collapse" data-target="#edSel_opt"><span>Experimental density map </span>
                   <span id="loading_edmap" style="display:none"><img src="{% static 'view/images/loading-gear.gif' %}" style="width:17px;height:17px;"/></span>
                  <span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-up arrow"></span></div> 
            </div>
            <div id="edSel_opt" class="collapse in" style="padding-left:15px;">
            <!-- ============= ED Comp buttonss (ED quicksel) =========== -->
              <div id="ed_quicksel_all" style="margin-bottom:5px">
                <div class="row" style="margin-top:5px;">
                    <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#ed_quicksel"><span>Quick selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 

                  <div id="ed_quicksel" class="collapse" style="padding-right:15px;">
                    <!--<div style="margin:10px 0;font-size:13px">
                         <div class="btn-group btn-group-xs">
                          <button type="button" id="EdrepsOn" class="btn btn-default EdrepsSet active" style="padding:2px 5px 2px 5px;">On</button>
                          <button type="button" id="EdrepsOff" class="btn btn-default EdrepsSet" style="padding:2px 5px 2px 5px;">Off</button>
                        </div> 
                        Apply default representations
                    </div> -->
                    <div  style="margin-top:10px;margin-bottom:10px">
                      <center>
                        <div id="ed_map_btns"  >
                          <button title="{{chains}}" style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default ed_receptor nglCallBtn changefocus  ed_map_el"  id="ed_receptor">Receptor</button>

                          {% for long_n, short_n, ctype, load_heavy_tag in compounds %}
                              {% if ctype == "Ligand" %}
                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default  ed_map_el nglCallBtn changefocus  ed_ligand" title="{{short_n}}" data-shortn="{{short_n}}" >{{long_n}}</button>
                              {% endif %}
                          {% endfor %}
                          <!--<button style="margin-bottom:10px;margin-right:3px;margin-left:3px;min-width:16%;padding:5px;text-transform:capitalize;" class="btn btn-default  ed_map_el nglCallBtn changefocus  ed_free" title="Center the electron density map on selection.">Free selection</button>-->
                        </div>
                        <!--<div id="ed_map_input" >
                          <input value="" class="form-control" placeholder="Specify your selection" style="margin-top:10px;width: 100%; background-color: rgb(248, 248, 248);" type="text">
                        </div>-->
                    </center>
                  </div>

                  {% if TMsel_all %}
                  <center>
                    <div style="height:1px;background-color:lightgrey;width:90%"></div>
                  </center>
                  <div class="row" style="margin-top:15px;margin-bottom:10px">
                    <center >
                    {% for tmname, tmsel in TMsel_all %} 
                        <button style="margin-bottom:10px;margin-right:3px;margin-left:3px;padding:5px 10px 5px 10px;" class="btn btn-default changefocus  ed_tmsel ed_map_el changefocus"  id="ed_quick_{{tmname}}" data-tmsel="{{tmsel}}">{{tmname}}</button>
                    {% endfor %}
                    </center>
                  </div>
                  {% endif %}

                  </div><!-- end ed_quicksel -->
                </div>
              </div><!-- end ed_quicksel_all-->

            <!-- ============= ED atom sel =========== -->
             <div id="ed_atomsel_all" style="margin-bottom:5px">
                <div class="row" style="margin-top:5px;">
                    <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#ed_atomsel"><span>Custom selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 
                  <div id="ed_atomsel" class="collapse" style="padding-right:15px;">
                    <div style="margin-top:10px;margin-bottom:10px">


                          <div  class="ed_input_row" id="ed_ti_row0" style="margin-bottom:5px;padding-left: 15px">
                             <div  class="">
                                <div class="ed_ti_left " style="padding-right:3px;padding-left:3px;width:90%;float:left"> 
                                  <input value="" class="form-control  ed_input" id="ed_sel_input" placeholder="Specify your selection." style="width:100%;background-color:#F8F8F8" type="text">
                                </div>
                                <button class="btn btn-default ed_map_el changefocus act_input " id="ed_sel_input_btn" style="width:10%;display:inline"  data-toggle="popover" data-placement="right" data-content="Click to apply." data-trigger="manual" >Apply</button>
                            </div>
                            <div class="ed_ti_alert">
                              <div class="ed_ti_alert_gnum ed_alert_inst col-md-12" style="margin-top:5px"></div>
                              <div class="ed_ti_alert_ngl ed_alert_inst col-md-12" style="margin-top:5px"></div>
                            </div>      
                          </div>

                    </div>
                  </div><!-- end ed_atomsel -->
                </div>
              </div><!-- end ed_atomsel_all-->

      <!-- ============= ED Sequence selection =========== -->
              {% if prot_seq_pos %}
              <div id="ed_seqselection_all" style="margin-bottom:5px;margin-top:5px">
                  <div class="row">
                      <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#ed_seqselection"><span>Sequence selection </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 
                  </div>
                  <div id="ed_seqselection" class="collapse" style="padding-right:15px;">
                    <div style="margin-top:10px;margin-bottom:10px">




                    <div id="ed_seq_sel_div" style="padding:5px;border:1px solid #F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                      <button  type="button" id="ED_addToSel" class="btn btn-default changefocus ed_map_el act_seq_input" style="margin-left:10px" data-toggle="popover" data-placement="right" data-content="Click to apply." data-trigger="manual"> Apply</button>
                    
                      <div class="row" style="margin:10px;width:auto;height:250px;overflow:auto;">
                        {% for prot_name, seq_pos in prot_seq_pos %}
                          <div style="clear: left;padding-bottom:20px">
                            {% if prot_seq_pos|length > 1 %}
                               <div>{{prot_name}}</div>
                            {% endif %}
                            {% for seq,pos,gnum,chain,index in seq_pos %}
                            <div id="ed_{{index}}" title="{{gnum}}" class="ed_seq_sel" style="cursor:pointer;float: left;text-align:center;font-size:10px;margin-bottom:5px;background-color:#f2f2f2">
                              <div id="ed_ss_seq" style="clear: left;border:1px solid #E8E8E8; ;width:25px;height:15px">{{seq}}</div>
                              <div id="ed_ss_pos" class="{{chain}}" style="clear: left;border:1px solid #E8E8E8 ;width:25px;height:15px">{{pos}}</div>
                            </div>            
                            {% endfor %}
                          </div>
                        {% endfor %}
                      </div> 
                    </div>






                    </div>
                  </div><!-- end ed_seqselection -->
                
              </div><!-- end ed_seqselection_all-->
            {% endif %}

      <!-- ============= ED Predefined views of cons pos =========== -->
            {% if gpcr_pdb != "no" %}
              <div id="ed_cons_pos_box_all" style="margin-top:5px;margin-bottom:5px">
                <div class="row">
                    <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#ed_cons_pos_box"><span>GPCR conserved positions </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div>               
                    <!--<button style="background-color:#ffffff;text-align:left;border-bottom:2px solid blue;border-radius:0"  type="button" class="btn btn-block" data-toggle="collapse" data-target="#cons_pos_box">GPCR conserved positions</button>-->
                </div>
                <div  class="collapse cons_pos_section" id="ed_cons_pos_box" style="padding-right:15px;padding-left:15px;padding-top:10">
                  {% if gpcr_id_name|length > 1 %}
                  
                      <div class="row" style="margin-bottom:10px">
                            <select class="form-control gpcr_sel" style="width:100%;height:32px;" >
                              <option value="all">All GPCRs</option>
                              {% for gpcr_id, prot_name in gpcr_id_name.items %}
                              <option value="{{gpcr_id}}">{{prot_name}}</option>
                              {% endfor %}
                            </select>
                      </div>
                      <!-- Conserved pos for all GPCRs -->
                          <div  class="gpcr_prot_show_cons gpcr_id_all" style="display:inline">
                              <ul class="nav nav-tabs" id="ed_allclasses">
                                <li class="GPCRclass {{cons_pos_all_info.2.A.0}} cons_nav" data-TF="{{cons_pos_all_info.1.A}}"><a data-TF="{{cons_pos_all_info.1.A}}" class="cons_nav" data-toggle="tab" href="#ed_classA_all">Class A</a></li>
                                <li class="GPCRclass {{cons_pos_all_info.2.B.0}} cons_nav" data-TF="{{cons_pos_all_info.1.B}}"><a data-TF="{{cons_pos_all_info.1.B}}" class="cons_nav" data-toggle="tab" href="#ed_classB_all">Class B</a></li>
                                <li class="GPCRclass {{cons_pos_all_info.2.C.0}} cons_nav" data-TF="{{cons_pos_all_info.1.C}}"><a data-TF="{{cons_pos_all_info.1.C}}" class="cons_nav" data-toggle="tab" href="#ed_classC_all">Class C</a></li>
                                <li class="GPCRclass {{cons_pos_all_info.2.F.0}} cons_nav" data-TF="{{cons_pos_all_info.1..F}}"><a data-TF="{{cons_pos_all_info.1..F}}" class="cons_nav" data-toggle="tab" href="#ed_classF_all">Class F</a></li>
                              </ul>
                              <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                                  <div style="margin:0;" id="ed_classA_all" class="tab-pane {{cons_pos_all_info.2.A.1}}">
                                      {% if cons_pos_all_info.1.A %}
                                          {% if cons_pos_all_info.0.A.1 %}
                                              <p>Highly conserved residues and motifs</p>
                                                {% for pos in cons_pos_all_info.0.A.1 %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                                {% for pos in motifs_all_info.A %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                          {% if cons_pos_all_info.0.A.0 %}
                                              <p>Most conserved residues</p>
                                                {% for pos in cons_pos_all_info.0.A.0 %}
                                                 <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                      {% endif %}
                                  </div>
                                  <div id="ed_classB_all" class="tab-pane {{cons_pos_all_info.2.B.1}}">
                                        {% if cons_pos_all_info.0.B.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_pos_all_info.0.B.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdB_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}   
                                        {% endif %}                         
                                  </div>  
                                  <div id="ed_classC_all" class="tab-pane {{cons_pos_all_info.2.C.1}}">
                                        {% if cons_pos_all_info.0.C.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_pos_all_info.0.C.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdC_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>  
                                  <div id="ed_classF_all" class="tab-pane {{cons_pos_all_info.2.F.1}}">
                                        {% if cons_pos_all_info.0.F.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_pos_all_info.0.F.0 %}
                                        <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdF_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>
                                  <button class="btn btn-link pull-right clear_conspos ed_section" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear</button>
                             </div>
                          </div>
                      <!-- Conserved pos for each of the GPCRs -->
                      {% for gpcr_id, gpcr_name, show_class,active_class, cons_class, motifs_def in all_gpcrs_info %}            
                          <div  class="gpcr_prot_show_cons gpcr_id_{{gpcr_id}}" style="display:none">
                              <ul class="nav nav-tabs" id="ed_allclasses">
                                <li class="GPCRclass {{active_class.A.0}} cons_nav" data-TF="{{show_class.A}}"><a data-TF="{{show_class.A}}" class="cons_nav" data-toggle="tab" href="#ed_classA_{{gpcr_id}}">Class A</a></li>
                                <li class="GPCRclass {{active_class.B.0}} cons_nav" data-TF="{{show_class.B}}"><a data-TF="{{show_class.B}}" class="cons_nav" data-toggle="tab" href="#ed_classB_{{gpcr_id}}">Class B</a></li>
                                <li class="GPCRclass {{active_class.C.0}} cons_nav" data-TF="{{show_class.C}}"><a data-TF="{{show_class.C}}" class="cons_nav" data-toggle="tab" href="#ed_classC_{{gpcr_id}}">Class C</a></li>
                                <li class="GPCRclass {{active_class.F.0}} cons_nav" data-TF="{{show_class.F}}"><a data-TF="{{show_class.F}}" class="cons_nav" data-toggle="tab" href="#ed_classF_{{gpcr_id}}">Class F</a></li>
                              </ul>
                              <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                                  <div style="margin:0;" id="ed_classA_{{gpcr_id}}" class="tab-pane {{active_class.A.1}}">
                                      {% if show_class.A %}
                                          {% if cons_class.A.1 %}
                                              <p>Highly conserved residues and motifs</p>
                                                {% for pos in cons_class.A.1 %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                                {% for pos in motifs_def.A %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                          {% if cons_class.A.0 %}
                                              <p>Most conserved residues</p>
                                                {% for pos in cons_class.A.0 %}
                                                 <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus"  data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                      {% endif %}
                                  </div>
                                  <div id="ed_classB_{{gpcr_id}}" class="tab-pane {{active_class.B.1}}">
                                        {% if cons_class.B.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.B.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdB_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}   
                                        {% endif %}                         
                                  </div>  
                                  <div id="ed_classC_{{gpcr_id}}" class="tab-pane {{active_class.C.1}}">
                                        {% if cons_class.C.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.C.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdC_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>  
                                  <div id="ed_classF_{{gpcr_id}}" class="tab-pane {{active_class.F.1}}">
                                        {% if cons_class.F.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.F.0 %}
                                        <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdF_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>
                                  <button class="btn btn-link pull-right clear_conspos ed_section" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear</button>
                             </div>
                          </div>
                      {% endfor %}
                     {% else %} <!-- When only 1 gpcr: -->
                         {% for gpcr_id, gpcr_name, show_class,active_class, cons_class, motifs_def in all_gpcrs_info %}            
                          <div  class="gpcr_prot_show_cons gpcr_id_{{gpcr_id}}">
                              <ul class="nav nav-tabs" id="ed_allclasses">
                                <li class="GPCRclass {{active_class.A.0}} cons_nav" data-TF="{{show_class.A}}"><a data-TF="{{show_class.A}}" class="cons_nav" data-toggle="tab" href="#ed_classA"> Class A</a></li>
                                <li class="GPCRclass {{active_class.B.0}} cons_nav" data-TF="{{show_class.B}}"><a data-TF="{{show_class.B}}" class="cons_nav" data-toggle="tab" href="#ed_classB">Class B</a></li>
                                <li class="GPCRclass {{active_class.C.0}} cons_nav" data-TF="{{show_class.C}}"><a data-TF="{{show_class.C}}" class="cons_nav" data-toggle="tab" href="#ed_classC">Class C</a></li>
                                <li class="GPCRclass {{active_class.F.0}} cons_nav" data-TF="{{show_class.F}}"><a data-TF="{{show_class.F}}" class="cons_nav" data-toggle="tab" href="#ed_classF">Class F</a></li>
                              </ul>
                              <div  class="row tab-content" style="background-color:#F3F3F3;margin-bottom:10px; padding:10px; border-radius:10px;">
                                  <div style="margin:0;" id="ed_classA" class="tab-pane {{active_class.A.1}}">
                                      {% if show_class.A %}
                                          {% if cons_class.A.1 %}
                                              <p>Highly conserved residues and motifs</p>
                                                {% for pos in cons_class.A.1 %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                                {% for pos in motifs_def.A %}
                                                <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}" title="{{pos.1}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                          {% if cons_class.A.0 %}
                                              <p>Most conserved residues</p>
                                                {% for pos in cons_class.A.0 %}
                                                 <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}" class="high_pd ed_map_el high_pdA_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                                {% endfor %}
                                          {% endif %}
                                      {% endif %}
                                  </div>
                                  <div id="ed_classB" class="tab-pane {{active_class.B.1}}">
                                        {% if cons_class.B.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.B.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdB_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                          {% endfor %}   
                                        {% endif %}                         
                                  </div>  
                                  <div id="ed_classC" class="tab-pane {{active_class.C.1}}">
                                        {% if cons_class.C.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.C.0 %}
                                          <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdC_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>  
                                  <div id="ed_classF" class="tab-pane {{active_class.F.1}}">
                                        {% if cons_class.F.0 %}
                                          <p>Most conserved residues</p>
                                          {% for pos in cons_class.F.0 %}
                                        <button style="margin-bottom:10px;margin-right:3px;margin-left:3px" title="{{pos.1}}"    class="high_pd ed_map_el high_pdF_ed btn btn-default changefocus" data-pdbpos="{{pos.2}}">{{pos.0}}</button>
                                         {% endfor %}
                                        {% endif %}
                                  </div>
                                  <button class="btn btn-link pull-right clear_conspos ed_section" style="color:#DC143C;margin-bottom;0;padding-bottom:0">Clear</button>
                             </div>
                          </div>
                         {% endfor %}

                  {% endif %}
                </div>
              </div>
            {% endif %}


            <!-- ============= ED controls=========== -->
              <div id="ed_ctrl_all" style="margin-bottom:5px">
                <div class="row" style="margin-top:5px;">
                    <div class="section_pan" style="cursor:pointer;padding:5px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337AB7;border-radius:0" data-toggle="collapse" data-target="#ed_ctrl"><span>Selection settings </span><span style="float:right;margin-right:5px" class="glyphicon glyphicon-chevron-down arrow"></span></div> 

                  <div id="ed_ctrl" class="collapse" style="padding-right:15px;">

                    
                    <div id="ed_no_sel_warning" class="alert alert-warning fade in alert-dismissible" style="margin:15px 0 auto;font-weight:bold;">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close">×</a>
                        Make a selection to display the map.
                    </div>

                    <div style="margin:10px" class="row">
                         Apply default representations
                         <div class="btn-group btn-group-xs">
                          <button type="button" id="EdrepsOn" class="btn btn-default EdrepsSet active" style="padding:2px 5px 2px 5px;">On</button>
                          <button type="button" id="EdrepsOff" class="btn btn-default EdrepsSet" style="padding:2px 5px 2px 5px;">Off</button>
                        </div> 
                    </div> 
                    <div class="table-responsive" style="">
                      <table class="table" style="font-size:14px">
                        <thead>
                          <tr>
                            <th></th>
                            <th style="text-align:center">2fo-fc</th>
                            <th style="text-align:center">fo-fc</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td style="text-align:right;font-weight:bold">Display map</td>
                            <td style="text-align:center">
                              <label class="checkbox" style="margin:0">
                                <input checked type="checkbox" disabled class="EDdisplay" value="2fofc" style="margin-left:-5px;margin-top:0,margin-bottom:0">
                              </label>
                            </td>
                            <td style="text-align:center">
                              <label class="checkbox"  style="margin:0">
                                <input checked type="checkbox" disabled class="EDdisplay" value="fofc" style="margin-left:-5px;margin-top:0,margin-bottom:0">
                              </label>
                            </td>
                          </tr>
                          <tr>
                            <td style="text-align:right;font-weight:bold">Map color</td>
                            <td style="text-align:center" >
                                <!-- color dropdown html 2fo-fc-->
                               <div id="ED2fofcColor" class="EDcolsect" data-map="2fofc" style="display:inline-block;margin:auto;width:16px" data-short="16px" data-long="80px"><!-- to 80-->
                                        <div class="dropdown displaydrop ed_ddwn" style="float:left;height:16px;padding:0;margin-top:4px">
                                          <button class="dropbtn freedef" style="background-color:#87ceeb" data-color="#87ceeb"></button> 
                                          <div class="dropdown-content" >
                                                <div class="dropcolor EDcolorDef" style="background-color:#3cb371;width:16px; height: 16px;" data-color="#3cb371"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#B3072F;width:16px; height: 16px;" data-color="#B3072F"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#ff6347;width:16px; height: 16px;" data-color="#ff6347"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#c5c5c5;width:16px; height: 16px;" data-color="#c5c5c5"></div>
                                                <div style="background-color:white;width:16px; height: 16px;border:1px solid #808080;" class="dropcolor morecolors EDcolorDef" data-color="#FFFFFF"><span class="glyphicon glyphicon-plus-sign" style="color:#696969;padding-left:1px"></span></div>
                                          </div>
                                        </div>
                                        <span class="span_morecolors displaydrop" style="float:left" ></span>
                                        <span style="display:none" data-color="#87ceeb" class="EDselcolvar"></span>
                                </div>
                                <!-- end color dropdown 2fo-fc -->

                            </td>
                            <td style="text-align:center" >

                              <!-- color dropdown html fo-fc Positive-->
                              <div id="EDfofcColorPos" class="EDcolsect" data-map="fofcpos" style="display:inline-block;margin: 1px 5px 1px 1px;width:45px" data-short="45px" data-long="110px"><!-- to 110-->
                                        <div class="testtest" style="float:left;margin-top:2px;margin-right:4px;">
                                          Pos
                                        </div>
                                        <div class="dropdown displaydrop ed_ddwn" style="float:left;height:16px;padding:0;margin-top:4px">
                                          <button class="dropbtn freedef" style="background-color:#3cb371" data-color="#3cb371"></button> 
                                          <div class="dropdown-content" >
                                                <div class="dropcolor EDcolorDef" style="background-color:#87ceeb;width:16px; height: 16px;" data-color="#87ceeb"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#B3072F;width:16px; height: 16px;" data-color="#B3072F"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#ff6347;width:16px; height: 16px;" data-color="#ff6347"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#c5c5c5;width:16px; height: 16px;" data-color="#c5c5c5"></div>
                                                <div style="background-color:white;width:16px; height: 16px;border:1px solid #808080;" class="dropcolor morecolors EDcolorDef" data-color="#FFFFFF"><span class="glyphicon glyphicon-plus-sign" style="color:#696969;padding-left:1px"></span></div>
                                          </div>
                                        </div>
                                        <span class="span_morecolors displaydrop" style="float:left" ></span>
                                        <span style="display:none" data-color="#3cb371" class="EDselcolvar"></span>
                                </div>
                              <!-- end color dropdown fo-fc Pos-->
                              
                              <!-- color dropdown html fo-fc Negative-->
                              <div id="EDfofcColorNeg" class="EDcolsect" data-map="fofcneg" style="display:inline-block;margin:1px;width:47px" data-short="47px" data-long="110px"><!-- to 110-->
                                        <div style="float:left;margin-top:2px;margin-right:4px">
                                          Neg
                                        </div>
                                        <div class="dropdown displaydrop ed_ddwn" style="float:left;height:16px;padding:0;margin-top:4px">
                                          <button class="dropbtn freedef" style="background-color:#ff6347" data-color="#ff6347"></button> 
                                          <div class="dropdown-content" >
                                                <div class="dropcolor EDcolorDef" style="background-color:#87ceeb;width:16px; height: 16px;" data-color="#87ceeb"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#B3072F;width:16px; height: 16px;" data-color="#B3072F"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#3cb371;width:16px; height: 16px;" data-color="#3cb371"></div>
                                                <div class="dropcolor EDcolorDef" style="background-color:#c5c5c5;width:16px; height: 16px;" data-color="#c5c5c5"></div>
                                                <div style="background-color:white;width:16px; height: 16px;border:1px solid #808080;" class="dropcolor morecolors EDcolorDef" data-color="#FFFFFF"><span class="glyphicon glyphicon-plus-sign" style="color:#696969;padding-left:1px"></span></div>
                                          </div>
                                        </div>
                                        <span class="span_morecolors displaydrop" style="float:left" ></span>
                                        <span style="display:none" data-color="#ff6347" class="EDselcolvar"></span>
                                </div>
                              <!-- end color dropdown fo-fc Neg-->

                            </td>
                          </tr>
                          <tr>
                            <td style="text-align:right;font-weight:bold">Map style</td>
                            <td style="text-align:center">
                              <select class="form-control input-sm EDmapStype" data-map="2fofc" id="EDmapStype2fofc" style="padding:0;font-size:14px;margin:1px">
                                 <option selected value="contour">Contour</option>
                                 <option value="wireframe">Wireframe</option>
                                 <option value="smooth">Smooth</option>
                                 <option value="flat">Flat</option>
                              </select>
                            </td>
                            <td style="text-align:center">
                              <select class="form-control input-sm EDmapStype" data-map="fofc" id="EDmapStypefofc" style="padding:0;font-size:14px;margin:1px">
                                 <option selected value="contour">Contour</option>
                                 <option value="wireframe">Wireframe</option>
                                 <option value="smooth">Smooth</option>
                                 <option value="flat">Flat</option>
                              </select>
                            </td>
                          </tr>
                          <tr>
                            <td style="text-align:right;font-weight:bold">ISO level</td>
                            <td style="text-align:center">
                              <center>
                                <div class="slider_div"  style="max-width:150px;display:inline-block">
                                  <input class="slider edslider" data-valtype="isolevel" data-map="2fofc" value="1.5" min="0" max="10" step="0.1" type="range">
                                </div>
                                <div class="slider_val" id="slider_val_2fofc" style="width:20px;display:inline-block;color:#b3b3b3">1.5</div>
                              </center>
                            </td>
                            <td style="text-align:center">                              
                              <center>
                                <div class="slider_div" style="max-width:150px;display:inline-block">
                                  <input class="slider edslider" data-valtype="isolevel"  data-map="fofc" value="3" min="0" max="10" step="0.1" type="range">
                                </div>
                                <div class="slider_val" id="slider_val_fofc" style="color:#b3b3b3;width:20px;display:inline-block">3</div>
                              </center>
                            </td>
                          </tr>
<!--                          <tr>
                            <td style="text-align:right;font-weight:bold">Map size</td>
                            <td style="text-align:center">
                              <center>
                                <div class="slider_div" style="max-width:150px;display:inline-block">
                                  <input class="slider edslider" data-valtype="mapsize" data-map="2fofc" value="20" min="0" max="100" step="1" type="range">
                                </div>
                                <div class="slider_val" style="width:20px;display:inline-block;color:#b3b3b3">20</div>
                              </center>
                            </td>
                            <td style="text-align:center">                              
                              <center>
                                <div class="slider_div" style="max-width:150px;display:inline-block">
                                  <input class="slider edslider" data-map="fofc" data-valtype="mapsize" value="20" min="0" max="100" step="1" type="range">
                                </div>
                                <div class="slider_val"  style="color:#b3b3b3;width:20px;display:inline-block">20</div>
                              </center>
                            </td>
                          </tr>-->
                          <tr>
                            <td style="text-align:right;font-weight:bold">Zoom</td>
                            <td style="text-align:center" colspan="2">
                              <center>
                                <div class="slider_div" style="width:50%;display:inline-block">
                                  <input class="slider edslider" id="EDmapzoom" data-valtype="zoom" value="0" min="0" max="100" step="1" type="range">
                                </div>
                                <div class="slider_val" id="EDmapzoom_val" style="width:20px;display:inline-block;color:#b3b3b3">0</div>
                              </center>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    
                  </div><!-- end ed_ctrl -->
                </div>
              </div><!-- end ed_ctrl_all-->

            </div>
          </div><!-- end edSel -->
          {% endif %}

        </div><!-- End allSelTools -->

          
    </div> <!-- Panel-body -->          
   </div>
          
          <!--<input type="checkbox" name="nglCall" value="nglCallSign">-->
        </div>
         
    </div> <!-- left half -->

     <div class="col-lg-6" id="right_half" style="padding:0 7px">
        <div class="col-md-12 panel panel-primary" id="rightPanelID" style="margin-bottom:10px;height:100%;position: relative; overflow-y: auto; overflow-x: hidden;">
            <div class="panel-body" style="padding-top:10px;margin-bottom:0;">
                <div class="container-fluid" id="main_analysis_container">        
<!-- ANALYSIS -->                
                
<!-- ============= Analysis =========== --> 
           {% if traj_list %}  
        <div style="text-align:center;margin:0;padding:5px;">
            <div class="row" style="background-color:#F3F3F3; border-radius:2px;">
                <h4 id="analysisDiv" style="padding:0;margin:0;padding:5px;">GPCRmd Toolkit
                </h4>
            </div>
        </div>
           <div id="all_analysis" style="margin-bottom:30px">   
<!-- ======================================== -->
      {% if is_metadyn %}
        {% if is_metadyn.files_avail %}
           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_metadynview" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>MetadynView </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-up arrow"></span></div>
           </div>
           <div id="analysis_metadynview" class="collapse in" >
              <div class="row">
                  <div style="margin:20px 20px 0 40px" id="sync">
                    <div style="float:left;margin:5px">
                        Fix MetadynView
                        <div class="btn-group btn-group-xs">
                          <button id="syncronize_opt_on" type="button" data-state="on"  class="btn btn-default syncronize_opt" style="padding:2px 5px 2px 5px;">On</button>
                          <button id="syncronize_opt_off" type="button" data-state="off" class="btn btn-default syncronize_opt active" style="padding:2px 5px 2px 5px;">Off</button>
                        </div>
                    </div>
                    <div style="float:left;margin:5px" id="sync">
                      <button class="btn btn-default btn-xs changefocus" style="padding:2px 5px 2px 5px;" id="metadyn_finalFES">Final free energy surface</button>
                    </div>
                  </div>
              </div>

              <div class="row">
                  <div  style="overflow-y: hidden;overflow-x:auto; margin:auto; max-height: 660px;">
                    <div style="margin:auto;width:870px">
                      <iframe   id="embed_metadynview" style="border: 0px none;margin:-15px;width:870px;height:660px" src="{{mdsrv_url}}/html/metadyndiet/index.html#hil={{ is_metadyn.hills_path }}&mes=true" scrolling="no" ></iframe>
                  </div>

                  <!--<div style="max-width:550px ;overflow-y: hidden;overflow-x:auto; margin: 35px 15px 15px 15px; max-height: 465px;border:1px solid #e6e6e6;float:left">
                      <iframe  id="embed_ngl" class="str_file traj_file lig_element" data-resname="8NU"   style="border: 0px none;width: 545px;margin-top:-35px;" id="embed_mdsrv" src="{{mdsrv_url}}/html/embed_metadyn.html" scrolling="no" height="461px" width="545px" data-struc_file="{{structure_file}}" data-traj_file="{{traj_file}}" ></iframe>
                  </div>-->
              </div>
           </div>
        {% endif %}
      {% else %}
        {% if show_fp %}
           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_fplot" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Interaction network </span><span style="float:right;margin-right:5px;" class="glyphicon {% if watervol_def or pharmacophore_def or tunnels_channels_def or ligprotint_def %}glyphicon-chevron-down{% else %}glyphicon-chevron-up{% endif %} arrow"></span></div>
           </div>
           <div id="analysis_fplot" class="collapse {% if watervol_def or pharmacophore_def or tunnels_channels_def or ligprotint_def %} {% else %} in {% endif %}" >
<!--                <div style="height:15px;margin:0;padding:0">
                    <span class="showIfTrajFPBlock" style="color:#808080;">
                        Hydrogen bonding network
                    </span>
                </div>-->
                <!--<span id="fphoverinfo"></span>-->


                  <div id="loading_fp" style="">
                    <center >
                      <img style="height:50px" src="{% static 'view/images/loading-gear.gif' %}" />
                    </center>
                  </div>

                
                <div id="fpdiv" data-show_fp="{{show_fp}}" style="margin-top:15px;overflow:auto;margin-bottom:10px">
                <div style="z-index:1; position: absolute;color:gray" id="fp_int_type_info">
                  {% if traj_list.0.3.1.0 == "hb" or traj_list.0.3.1.0 == "hbonds" %}
                    <p class="fp_int_type_info_p">Hydrogen bonds:</p> 
                    <p class="fp_int_type_info_p">{{traj_list.0.3.1.1}}</p>
                  {% else %}
                    <p class="fp_int_type_info_p">{{traj_list.0.3.1.1}}</p>
                  {% endif %}
                </div>
               <center>
                 <div id="flare-container">
                  {% if not traj_list.0.3.1.2 %}
                     <div class="alert alert-info" style="margin:95px 0;">
                        There is no flare plot available for this trajectory and interaction type yet.
                     </div>
                   {% endif %}
                 </div>

                  <span id="allFPoptions" class="showIfTrajFP">

                      <div class="dropup" style="display:inline-block;position: relative;" >
                        <button class="btn btn-default dropdown-toggle changefocus" type="button" data-toggle="dropdown" style="margin-top:15px;width:115px;font-size:12px;" title="Define the interaction type to be displayed in the plot.">Interaction type
                        <span class="caret"></span></button>
                        <ul id="ul_fp_int_type" class="dropdown-menu" style="font-size:12px;margin-bottom:-12px">
                          <!--if network_def 
                             <li class="dropdown-submenu">
                                  <a style="padding:5px 15px 5px 15px;" class="submenu_btn">Hydrogen bonds</a>
                                  <ul class="dropdown-menu" >
                                      <li  data-tag="{{traj_list.0.3.1.0}}" data-path="{{traj_list.0.3.1.2}}" style="padding:5px 15px 5px 15px;" class="fp_options fp_int_type submenu_el 
                                      {% if not traj_list.0.3.1.2 %} disabled {% endif %}"
                                        >{{traj_list.0.3.1.1}}</li>

                                      <li  data-tag="{{traj_list.0.3.2.0}}" data-path="{{traj_list.0.3.2.2}}" style="padding:5px 15px 5px 15px;" class="fp_options fp_int_type submenu_el
                                        {% if not traj_list.0.3.2.2 %} disabled {% endif %}"
                                        >{{traj_list.0.3.2.1}}</li>
                                  </ul>
                                </li>

                                <li  data-tag="{{traj_list.0.3.1.0}}" data-path="{{traj_list.0.3.1.2}}" style="padding:5px 15px 5px 15px;" class="fp_options fp_int_type is_active 
                                {% if not traj_list.0.3.1.2 %} disabled {% endif %}"
                                >{{traj_list.0.3.1.1}}</li>      

                                {% for int_info in traj_list.0.3|slice:"3:" %}
                                      <li  data-tag="{{int_info.0}}" data-path="{{int_info.2}}" style="padding:5px 15px 5px 15px;" class="fp_options fp_int_type 
                                      {% if not int_info.2 %} disabled {% endif %}"
                                      >{{int_info.1}}</li>
                                {% endfor %}
                      -->
                              <li class="dropdown-submenu">
                                <a style="padding:5px 15px 5px 15px;background-color:#f2f2f2;" class="submenu_btn">Hydrogen bonds</a>
                                <ul class="dropdown-menu" >
                                    <li  data-tag="{{traj_list.0.3.1.0}}" data-path="{{traj_list.0.3.1.2}}" style="padding:5px 15px 5px 15px;" class="is_active fp_options fp_int_type submenu_el 
                                    {% if not traj_list.0.3.1.2 %} disabled {% endif %}"
                                      >{{traj_list.0.3.1.1}}</li>

                                    <li  data-tag="{{traj_list.0.3.0.0}}" data-path="{{traj_list.0.3.0.2}}" style="padding:5px 15px 5px 15px;" class="fp_options fp_int_type submenu_el
                                      {% if not traj_list.0.3.0.2 %} disabled {% endif %}"
                                      >{{traj_list.0.3.0.1}}</li>
                                </ul>
                              </li>
                            
                              {% for int_info in traj_list.0.3|slice:"2:" %}
                                    <li  data-tag="{{int_info.0}}" data-path="{{int_info.2}}" style="padding:5px 15px 5px 15px;" class="fp_options fp_int_type 
                                    {% if not int_info.2 %} disabled {% endif %}"
                                    >{{int_info.1}}</li>
                              {% endfor %}
                        </ul>
                      </div>




                      <div class="dropup" style="display:inline-block;position: relative;" >
                        <button 
                            {% if traj_list.0.3.1.2 %}
                               class="btn btn-default dropdown-toggle changefocus disableIfNoIntFP"
                            {% else %}
                                class="btn btn-default dropdown-toggle changefocus disableIfNoIntFP disabled"
                            {% endif %}
                         type="button" data-toggle="dropdown" style="margin-top:15px;width:115px;font-size:12px;" title="Define what to display in the flare plot.">Display
                        <span class="caret"></span></button>
                        <ul class="dropdown-menu" style="font-size:12px;margin-bottom:-12px">
                          <li style="padding:5px 15px 5px 15px;font-weight:bold" class="dropdown-header">Interacting pairs</li>
                          <li id="fp_display_inter" class="fp_display_element fp_options fp_display_element_type {% if not network_def %}is_active{% endif %}" data-tag="Inter" style="padding:5px 15px 5px 15px;cursor:pointer;" title="Display only inter-helix interactions.">Inter-helix</li>
                          <li id="fp_display_all" class="fp_display_element fp_options fp_display_element_type {% if network_def %}is_active{% endif %}" data-tag="all" style="padding:5px 15px 5px 15px;cursor:pointer;" title="Display all interactions.">All</li>
                          <li style="margin-left:5px;margin-right:5px;" class="divider"></li>
                          <li style="padding:5px 15px 5px 15px;font-weight:bold" class="dropdown-header">Simulation</li>
                          <li id="fp_display_frame" class="fp_display_element fp_options is_active" style="padding:5px 15px 5px 15px;cursor:pointer;background-color:#bfbfbf" title="Display a summary of the itneractions formed during the simulation.">Current frame</li>
                          <li id="fp_display_summary" class="fp_display_element fp_options" style="padding:5px 15px 5px 15px;cursor:pointer;" title="Display interactions formed at each simulation frame.">Summary</li>
                        </ul>
                      </div>


                      <button id="FPdisplay" 
                          {% if traj_list.0.3.1.2 %}
                              class="btn btn-default active changefocus disableIfNoIntFP"
                          {% else %}
                              class="btn btn-default active changefocus disableIfNoIntFP disabled"
                          {% endif %}
                        title="Show/Hide structural representations of the residues selected at the plot." type="button" style="margin-top:15px;font-size:12px;width:115px;padding-right:2px;padding-left:2px;">
                        Show in structure
                      </button>


    <!-- Substitute ids and classes:
         .fpShowResSet
    -->
                   
                      <!--<button class="summarizeFP btn btn-default" type="button" style="margin-top:15px;width:115px;font-size:12px;">
                        Summarize
                      </button>-->
                     <!--<div class="btn-group" id="fpShowResSetBtns">
                      <button type="button" id="intraHel" class="btn btn-default fpShowResSet" title="Click to display intra-helix interactions">Intra-helix</button>
                      <button type="button" id="interHel" class="btn btn-default active fpShowResSet" title="Click to hide inter-helix interactions">Inter-helix</button>
                     </div> -->
                     
                     
                      <button id="FPclearSel"
                          {% if traj_list.0.3.1.2 %}
                              class="btn btn-danger disableIfNoIntFP"
                          {% else %}
                              class="btn btn-danger disableIfNoIntFP disabled"
                          {% endif %}
                        type="button" style="margin-top:15px;width:115px;font-size:12px;" title="Unselect all interactions from the plot.">
                        Clear plot
                      </button>
                      {% if traj_list.0.3.1.2 %}
                      <a role="button" id="downl_json_hb" class="btn btn-link settingsB disablewhencomp" href="{{traj_list.0.3.1.2}}" style="color:#585858;margin-top:15px;padding:0" target="_blank">
                      {% else %}
                      <a role="button" id="downl_json_hb" class="btn btn-link settingsB disablewhencomp disabled"  style="color:#585858;margin-top:15px;padding:0">
                      {% endif %}
                        <span title="Download data" class="glyphicon glyphicon-download-alt"></span>
                      
                      </a>
                  </span>
               </center>
               <!--<div class="showIfTrajFPBlock" style="margin-bottom:10px;margin-top:10px;color:#808080;">
                    <a href="https://github.com/GPCRviz/flareplot" target="_blank" >Flare Plots</a> powered by R. Fonseca and A. J. Venkatakrishnan.
                </div>-->
               </div><!-- End fpdiv -->
           </div> 
        {% endif %}
<!-- ======================================== -->

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#interaction_freqs" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>
Interaction frequencies 
</span><span style="float:right;margin-right:5px;" class="glyphicon {% if ligprotint_def %}glyphicon-chevron-up {% else %}glyphicon-chevron-down{% endif %} arrow"></span></div>
           </div>
           <div id="interaction_freqs"  class="collapse {% if ligprotint_def %}in{% endif %}" style="padding-left:15px;">

<!-- ============= BONDS Analysis =========== --> 

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_bonds" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #b3b3b3;border-radius:0;" ><span>
Hydrogen bonds 
</span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
           </div>
             <div id="analysis_bonds" class="collapse" style="padding-left:15px;">
                 <div class="row" style="margin-top:10px;margin-bottom:15px">


                        <div style="margin-left:18px;margin-bottom:10px;">
                         Trajectory: 
                                <select id="hbonds_traj" name="hbonds_traj">   
                                   {% for traj in traj_list %}
                                   <option   value="{{traj.0}}">
                                    Traj. ID {{traj.2}}
                                      {% if traj.4 %}
                                        ({{traj.4}})
                                      {% endif %}
                                   </option>
                                   {% endfor %}
                                </select>

                        </div>
                        <div class="col-md-12"  style="margin-left:18px;margin-bottom:10px;padding:0"> 
                           <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Frames:
                           </div>
                           <div id="bonds_sel_frames_id" class="col-md-10" style="margin-bottom:5px" >
                              <div class="row">
                                 <input type="radio" name="bonds_sel_frames" value="all_frames" checked> 
                                      All
                              </div>
                              <div class="row" >
                                 <input type="radio" name="bonds_sel_frames" value="bonds_frames_mine"> 
                                     From 
                                     <span id="bonds_frame_1_par">
                                         <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="bonds_frame_1" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                     </span>
                                     to 
                                     <span id="bonds_frame_2_par">
                                         <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="bonds_frame_2" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                     </span>

                              </div>
                              <div id="hbonds_sel_frames_error" class="row" >
                              </div>
                        </div>
                        
                        
                           <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Selection:
                           </div>
                           <div id="bonds_backbone" class="col-md-10" style="margin-bottom:10px">
                                 <div class="row">
                                  <input type="checkbox" name="neighbours" checked > Do not include hydrogen bonds between neighbours
                                  </div>

                                  <div class="row">
                                     <input type="radio" name="backbone" value="all" checked> 
                                          All hydrogen bonds
                                  </div>
                                  <div class="row" >
                                     <input type="radio" name="backbone" value="sidechain"> 
                                          Only side chain hydrogen bonds
                                  </div>


                              <!--<div class="row">
                                 <input type="radio" name="backbone" value="all" checked> 
                                       Include backbone hydrogen bonds
                              </div> -->
                           </div>
                        <div>
                            <span id="hbonds_cutoff_par">
                                Threshold: <input class="form-control input-sm changeThresh maxinp8 rvSpaces" placeholder=10 id="hbonds_cutoff" type="number" style="width:60px;padding-left:7px;margin-bottom:5px" title="Hydrogen bonds with a frequency lower than the threshold will be filtered out."> %
                            </span>
                        </div>
                 </div>


                <div class=row>
                  <button id="ComputeHbonds" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
                </div>
                <div id="bonds_alert" style="margin-top:5px;padding-right:15px;margin-left:14px;clear:left;z-index: 10;" class="row"> </div>
                 <div class="col-md-12" id="bondsresult_par" style="margin-top:10px;margin-bottom:15px;display:none;">

                        <div id="bondsresult" style="margin-bottom:20px"> 
                           <div style="padding:0"  class="col-md-12">
                              <div id="blockbondsresult" style="height:70px;background-color:white;position:absolute ;z-index:10;width:100%;cursor:progress;opacity:0.5;display:none"></div>
                              <div  id="hbonds" class="hbonds_both" style="margin-bottom:10px;padding:0"></div> 
                              <center class="hbonds_btns" id="hbonds_btn" style="display:none">
                                <button id="ShowAllHbIntra" class="btn btn-default" style="padding:5px;margin-left:10px;margin-right:15px;margin-bottom:20px;visibility:hidden;" >Show All</button>
                                <button style="color:#DC143C;margin-bottom;0;padding-bottom:0" class="btn btn-link pull-right clearAnalysisView" id="clear_showhb">Clear table</button>

                                <a role="button" class="btn btn-link href_save_data_hbp  disablewhencomp pull-right settingsB" href="/view/dwl/freq/hbp" style="color:#585858;padding:8px 0" data-linkroot="/view/dwl/freq/{{dyn_id}}/hbp">
                                  <span title="Save data" class="glyphicon glyphicon-download-alt"></span>
                                </a>

                               </center>


                               <div  id="hbondsnp" class="hbonds_both" style="margin-bottom:10px;padding:0;width:100%" ></div>
                               <center class="hbonds_btns" id="hbondsnp_btn" style="display:none;margin-bottom:10px">
                                    <button id="ShowAllHbInter" class="btn btn-default" style="padding:5px;margin-left:10px;margin-right:15px;visibility:hidden;" >Show All</button>
                                    <button style="color:#DC143C;margin-bottom;0;padding-bottom:0" class="btn btn-link pull-right clearAnalysisView" id="clear_showhb_inter">Clear table</button>
                                    <a role="button" class="btn btn-link href_save_data_hbo disablewhencomp pull-right settingsB" href="/view/dwl/freq/hbo" data-linkroot="/view/dwl/freq/{{dyn_id}}/hbo" style="color:#585858;padding:8px 0">
                                      <span title="Save data" class="glyphicon glyphicon-download-alt"></span>
                                    </a>
                                </center>
                                                         
                            
                           </div>
                        </div>

                    </div>
                  </div>
            </div>


<!-- ============= Interaction Analysis =========== --> 
            {% if ligands|length >= 1 %}
            
           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_Int" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #b3b3b3;border-radius:0;" ><span>Ligand receptor contacts  </span><span style="float:right;margin-right:5px;" class="glyphicon {% if ligprotint_def %}glyphicon-chevron-up {% else %}glyphicon-chevron-down{% endif %} arrow"></span></div>
           </div>
             <div id="analysis_Int" class="collapse {% if ligprotint_def %} in {% endif %}" style="padding-left:15px;">
             <div class="row" style="margin-top:10px;">
              
                    <div class="int_btw" style="margin-right:5px;margin-left:14px;margin-bottom:10px">
                         Compute interaction between GPCR and 
                            <select id="comp_int" name="comp_int">
                               <!--<option class="ligInt"  value="allLig">All ligands</option>-->
                               {% for long_n, short_n in ligands %}
                               <option class="ligInt unitInt"  value="{{short_n}}">{{long_n}}</option>
                               {% endfor %}
                             <!--  {% if other_prots%}
                               <option   value="{{other_prots.0}}">Other proteins</option>
                               {% endif %}-->
                            </select>  
                    </div>
                    <div style="margin-right:5px;margin-left:14px;margin-bottom:10px">
                         In trajectory: 
                           <span style="margin-left:5px">
                                <select id="interact_traj_sel" class="analysis_traj_sel" data-analysisstride="#int_stride" name="int_traj">
                                   <!--<option disabled selected value> </option>-->
                                   {% for traj in traj_list %}
                                   <option class="trajForInt" name="{{traj.0}}" value="{{traj.2}}" data-trajid={{traj.2}} >
                                      Traj. ID {{traj.2}}
                                        {% if traj.4 %}
                                          ({{traj.4}})
                                        {% endif %}
                                   </option>
                                   {% endfor %}
                                </select>
                           </span>
                           <span style="color:#DC143C;margin-left:5px" id="int_traj_error"></span>
                    </div>
                    <div style="margin-right:5px;margin-left:14px;margin-bottom:10px" id="int_stride_parent">
                        Stride: <input class="form-control input-sm inp_stride" id="int_stride"  type="number" data-default={{first_strideval}} placeholder={{first_strideval}} style="width:50px;padding-left:7px;">
                    </div>
                    <div style="margin-right:5px;margin-left:14px;margin-bottom:10px">
                        Threshold:
                          <input class="form-control input-sm " id="int_thr" type="number" title="Residues are considered to interact with the ligand when the distance beween any of the considered atoms is smaller than the threshold." style="width:50px;padding-left:7px;" value=3 placeholder=3> &#8491; 
                          <span style="color:#DC143C;margin-left:5px" id="int_thr_error"></span>
                    </div>
                    <div style="margin-right:5px;margin-left:14px;">
                         Consider 
                            <select id="dist_scheme" >
                               <option class="dist_scheme_opt"  value="closest">all atoms</option>
                               <option class="dist_scheme_opt"  value="closest-heavy">heavy atoms only</option>
                            </select>  
                    </div>
                    <div class="row">
                            <button id="gotoInt" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px;margin-top:5px" >Compute</button>
                    </div>
                    <div class="row" style="margin-top:5px;padding-right:15px;margin-left:14px" id="int_alert"> </div>
                    <div style="margin-top:5px;"  id="int_info" ></div>
                    <!--<div class="checkbox" style="margin-left:14px;margin-bottom:15px">
                    <label><input type="checkbox" name="view_int" checked >Display interacting residues</label>
                   </div>-->
              </div>
              </div>
            {% endif %}
           <!-- </div> original -->

<!-- ============= SaltBridges Analysis =========== --> 

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_salt" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #b3b3b3;border-radius:0;" ><span>Salt bridges </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
           </div>
             <div id="analysis_salt" class="collapse" style="padding-left:15px;">
             <div class="row" style="margin-top:10px;">

                    <div style="margin-left:18px;margin-bottom:5px;">
                     Trajectory: 
                            <select id="salt_traj" name="salt_traj">
                               {% for traj in traj_list %}
                               <option   value="{{traj.0}}">
                                  Traj. ID {{traj.2}}
                                    {% if traj.4 %}
                                      ({{traj.4}})
                                    {% endif %}
                               </option>
                               {% endfor %}
                            </select>

                    </div>
                    <div class="col-md-12"  style="margin-left:18px;margin-bottom:15x;padding:0"> 
                       <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Frames:
                       </div>
                       <div id="salt_sel_frames_id" class="col-md-10" >
                          <div class="row">
                             <input type="radio" name="salt_sel_frames" value="all_frames" checked> 
                                  All
                          </div>
                          <div class="row" >
                             <input type="radio" name="salt_sel_frames" value="salt_frames_mine"> 
                                 From 
                                 <span id="salt_frame_1_par">
                                     <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="salt_frame_1" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                 </span>
                                 to 
                                 <span id="salt_frame_2_par">
                                    <input class="form-control input-sm rvSpaces maxinp8 changeVal" id="salt_frame_2" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                                 </span>

                          </div>
                          <div id="salt_sel_frames_error" class="row" ></div>
                        </div>
                    </div>
             </div>

            <div class="row" style="margin-top:5px;margin-bottom:15px;margin-left:3px">
                Threshold: <input class="form-control input-sm changeThresh maxinp8 rvSpaces" id="salt_cutoff" type="number" placeholder=10 title="Salt bridges with a frequency lower than the threshold will be filtered out." style="width:60px;padding-left:7px;margin-bottom:5px"> %
            </div>

             <div class="row" style="margin-top:10px;margin-bottom:15px">
                    <div class=row>
                      <button id="ComputeSaltBridges" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
                    </div>
                    <div id="salt_alert" style="margin-top:5px;padding-right:15px;margin-left:14px;clear:left;z-index: 10;" class="row"> </div>
                    <div id="saltresult_par" style="display:none" class="col-md-12" >
                        <div id="saltresult" style="margin-bottom:20px"> 
                           <div style="margin-bottom:10px;padding:0"  class="col-md-12" >
                          <div id="blockSBbondsresult" style="height:100%;background-color:white;position:absolute ;z-index:10;width:100%;cursor:progress;opacity:0.5;display:none"></div>
                           <div class='scrolldowndiv' id="saltbridges" style="margin-bottom:10px;padding:0"></div>

                            <center>
                                <button id="ShowAllSb" class="btn btn-default" style="padding:5px;margin-left:10px;margin-right:15px;visibility:hidden" >Show All</button>
                                <button style="color:#DC143C;margin-bottom;0;padding-bottom:0" class="btn btn-link pull-right clearAnalysisView" id="clear_showsb">Clear table</button>
                                <a role="button" class="btn btn-link href_save_data_sb disablewhencomp pull-right settingsB" href="/view/dwl/freq/sb" data-linkroot="/view/dwl/freq/{{dyn_id}}/sb" style="color:#585858;padding:8px 0">
                                  <span title="Save data" class="glyphicon glyphicon-download-alt"></span>
                                </a>
                            </center>
                      
                           </div>
                        </div>
                      </div>

                </div>
              </div>

            </div><!-- END interaction_freqs -->
<!-- ============= Compute distances =========== --> 

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_dist" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Distance </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
            </div>
             <div id="analysis_dist" class="collapse row">
             <div style="margin-top:10px;margin-left:5px">
                <div style="margin-right:5px;margin-left:14px;margin-bottom:15px;color:#808080">
                    Select distances from the viewer by clicking on the atoms. Afterwards, import your selections by clicking at the import button (<span class="glyphicon glyphicon-circle-arrow-down" style="color:#1e90ff;margin:0;padding:0"></span>). You can also manually introduce the atom indices.
                </div>
                <div class="dist_btw" style="margin-right:5px;margin-left:0;">
                  <div class="dist_pair" id="row2_0" style="margin-bottom:5px">
                    <span class="tick2" ></span>
                    <span class="always2" style="margin-left:14px">
                     Compute distance between 
                     
                     <select class="dist_el_sel">
                        <option class="dist_el_opt" name="dist_el" value="atoms" selected >atoms</option>
                        <option class="dist_el_opt" name="dist_el" value="residues">residues</option>
                     </select>
                     
                     <span class="dist_from_parent">
                        <input class="form-control input-sm dist_from" type="text" title="Introduce atom index" style="width:50px;padding-left:7px;margin-bottom:5px">
                    </span>
                     <span class="dist_from_res_parent dis_res_bth_parent" style="display:none">
                        <input class="form-control input-sm dist_from_res dis_res_bth" type="text" title="Introduce residue number and chain name (ex. 50:P)" placeholder="xx:C" style="width:50px;padding-left:7px;margin-bottom:5px;">
                    </span>
                    <span class="dist_from_atomNm_parent"></span>
              and
                     <span class="dist_to_parent">
                         <input class="form-control input-sm dist_to" type="text" title="Introduce atom index" style="width:50px;padding-left:7px;margin-bottom:5px">
                     </span>
                     <span class="dist_to_res_parent dis_res_bth_parent" style="display:none">
                        <input class="form-control input-sm dist_to_res dis_res_bth" type="text" placeholder="xx:C" title="Introduce residue number and chain name (ex. 50:P)" style="width:50px;padding-left:7px;margin-bottom:5px;">
                    </span>
                     <span class="dist_to_atomNm_parent"></span>
                     <button class="btn btn-link del_btn2" style="color:#DC143C;font-size:20px;margin:0;padding:0" ><span class="glyphicon glyphicon-remove-sign"></span></button>  
                     <button class="btn btn-link only1st add_btn2" style="color:#57C857;font-size:20px;margin:0;padding:0" ><span class="glyphicon glyphicon-plus-sign"></span></button>
                     <button title="Import distances from the structure." class="btn btn-link only1st imp_btn2" style="color:#1e90ff;font-size:20px;margin:0;padding:0" ><span class="glyphicon glyphicon-circle-arrow-down"></span></button>
                     <!--<button id="rm_btn2"  class="btn btn-link" style="color:#DC143C;font-size:20px;margin:0;padding:0;visibility:hidden" ><span class="glyphicon glyphicon-minus-sign"></span></button> -->

                    </span>
                  </div>

                  <!--<span id="show_dist"></span>                  -->
                </div>
                
                {% if traj_list %}
                <div style="margin-left:17px;">
                    <div style="margin-bottom:10px;">
                     In trajectory: 
                       <span style="margin-left:5px">
                            <select id="dist_traj_sel" class="analysis_traj_sel" data-analysisstride="#dist_stride" name="dist_traj">
                               <!--<option disabled selected value> </option>-->
                               {% for traj in traj_list %}
                               <option class="trajForDist" name="{{traj.0}}" value="{{traj.2}}" data-trajid={{traj.2}}>
                                  Traj. ID {{traj.2}}
                                    {% if traj.4 %}
                                      ({{traj.4}})
                                    {% endif %}
                               </option>
                               {% endfor %}
                            </select>
                       </span>
                    </div>
                    <div id="dist_stride_parent">
                        Stride: <input class="form-control input-sm inp_stride" id="dist_stride"  type="number" data-default={{first_strideval}} placeholder={{first_strideval}} style="width:50px;padding-left:7px;">
                    </div>
                    <div class=row>
                        <button id="gotoDistPg" class="pull-right btn btn-info withTrajs" style="margin-top:5px;padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
                    </div>
                </div>
                {% else %}
                <button id="gotoDistPg" class="btn btn-info withoutTrajs" style="padding:5px;margin-left:14px;margin-right:15px" >Compute</button>
                {% endif %}
                <div class="row" style="margin-top:5px;padding-right:15px;margin-left:14px;clear:left;z-index: 10;" id="dist_alert"> </div>
                <div id="dist_chart" style="margin-bottom:15px"></div>
              <!-- <center><div style="margin-right:40px;overflow:auto;overflow-y:hidden;-ms-overflow-y: hidden;" >{{ chart.as_html }}</div></center>-->
               </div>
               </div>
<!-- ============= RMSD Analysis =========== --> 

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_rmsd" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>RMSD </span><span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span></div>
           </div>
             <div id="analysis_rmsd" class="collapse">
             <div class="row" style="margin-top:10px;margin-bottom:15px">

                    <div style="margin-left:18px;margin-bottom:10px;">
                     Trajectory: 
                            <select id="rmsd_traj_sel" class="analysis_traj_sel" data-analysisstride="#rmsd_stride" name="rmsd_traj">
                               <!--option disabled selected value> </option>-->
                               {% for traj in traj_list %}
                               <option   value="{{traj.0}}" data-trajid={{traj.2}}>
                                  Traj. ID {{traj.2}}
                                    {% if traj.4 %}
                                      ({{traj.4}})
                                    {% endif %}
                               </option>
                               {% endfor %}
                            </select>

                    </div>
                    <div class="col-md-12"  style="margin-left:18px;margin-bottom:10px;padding:0"> 
                       <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Frames:
                       </div>
                       <div id="rmsd_sel_frames_id" class="col-md-10" >
                          <div class="row">
                             <input type="radio" name="rmsd_sel_frames" value="all_frames" checked> 
                                  All
                          </div>
                          <div class="row" style="margin-bottom:5px">
                             <input type="radio" name="rmsd_sel_frames" value="rmsd_frames_mine"> 
                                 From 
                                 <span class="rmsd_from_parent">
                                   <input class="form-control input-sm maxinp8 changeVal" id="rmsd_frame_1" type="text" style="width:50px;padding-left:7px;">
                                 </span>
                                 to 
                                 <span class="rmsd_to_parent">
                                   <input class="form-control input-sm maxinp8 changeVal" id="rmsd_frame_2" type="text" style="width:50px;padding-left:7px;">
                                 </span>
                          </div>
                          <div style="margin-bottom:5px" id="rmsd_stride_parent" class="row">
                            Stride: <input class="form-control input-sm inp_stride" id="rmsd_stride" type="number" data-default={{first_strideval}} placeholder={{first_strideval}} style="width:50px;padding-left:7px;">
                          </div>

                          <div id="rmsd_sel_frames_error" class="row" >
                          </div>
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-left:18px;margin-bottom:10px;padding:0"> 
                        Reference: frame 
                            <input placeholder=0 class="form-control input-sm maxinp8 changeVal" id="rmsd_ref_frame" type="text" style="width:50px;padding-left:7px;margin-bottom:5px">
                            from trajectory 
                            <select id="rmsd_ref_traj_id" name="">
                               <!--<option disabled selected value> </option>-->
                               {% for traj in traj_list %}
                               <option   value="{{traj.0}}">
                                  Traj. ID {{traj.2}}
                                    {% if traj.4 %}
                                      ({{traj.4}})
                                    {% endif %}
                               </option>
                               {% endfor %}
                            </select>
                          <div class="col-md-12" id="rmsd_ref_frames_error" class="row" style="padding:0" >
                          </div>
                    </div>
                    <div id="rmsd_sel_id" style="margin-left:18px;margin-bottom:20px"> 
                       <div style="margin-bottom:10px;padding:0"  class="col-md-12">
                           <div style="margin-left:0;padding-left:0;width:70px;" class="col-md-2">Selection:
                           </div>
                           <div class="col-md-10" >
                              <div  class="row">
                                 <input type="radio" name="rmsd_sel" value="bck" checked> Protein alpha carbons
                              </div>
                              <div  class="row">
                                 <input type="radio" name="rmsd_sel" value="min"> Protein CA, CB, C, N, O
                              </div>
                              <div class="row">
                                 <input type="radio" name="rmsd_sel" value="noh"> Non-hydrogen protein atoms
                              </div>
                              <div class="row">
                                 <input type="radio" name="rmsd_sel" value="all_prot"> All protein atoms
                              </div>
                              {% for long_n, short_n in ligands %}
                                  <div class="row">
                                     <input type="radio" name="rmsd_sel" value="{{short_n}}"> {{long_n}}
                                  </div>
                              {% endfor %}
                              <!--<div class="row">
                                 <input type="radio" name="rmsd_sel" value="all_atoms"> All atoms
                              </div>-->
                           </div>
                        </div>
                   </div>
                    <div class=row>
                      <button id="gotoRMSDPg" class="pull-right btn btn-info" style="padding:5px;margin-left:10px;margin-right:15px" >Compute</button>
                    </div>
                    <div class="row" style="margin-left:14px;margin-top:5px;padding-right:15px;clear:left;" id="rmsd_alert"> </div>
                  <div class="col-md-12;clear:left;" id="rmsd_chart" ></div>
                </div>
              </div>




<!-- ============= Water Map Analysis =========== --> 
            {% if watermaps %}

           <div class="row">
                <div class="section_pan" data-toggle="collapse" data-target="#analysis_watermap" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Water volume distribution </span><span style="float:right;margin-right:5px;" class="glyphicon {% if watervol_def %}glyphicon-chevron-up{% else %}glyphicon-chevron-down{% endif %} arrow"></span></div>
           </div>
             <div id="analysis_watermap" class="collapse {% if watervol_def %}in{% endif %}" data-occupancy_data="{{occupancy}}">
                 <div class="row" style="margin-top:10px;margin-bottom:15px">

<!-- 
                        <div style="margin-left:18px;margin-bottom:10px;">
                         Trajectory: 
                                <select id="water_traj" name="water_traj">
                                   {% for traj in traj_list %}
                                   <option   value="{{traj.0}}">{{traj.1}}</option>
                                   {% endfor %}
                                </select>
                        </div> --> 

                        <!-- TABLE part -->
                        <div class="table-responsive" style="">
                          <table class="table" style="font-size:14px">
                            <thead>
                              <tr>
                            <th></th>
                            <th style="margin-left:10"> </th>
                          </tr>
                        </thead>

                        <tbody>
                          <tr>
                            <td style="text-align:left">Display map
                            </td>

                            <td style="text-align:left">
                              <label class="checkbox" style="margin:0">
                                <input {%if watervol_def%}checked{% endif %} type="checkbox" value="occupancy" class="WaterDisplay" style="margin-left:40px;margin-top:0,margin-bottom:0">
                              </label>
                              <span id="loading_display_watermap" style="display:none;margin-left:70px;">Loading... <img src="{% static 'view/images/loading-gear.gif' %}" style="width:17px;height:17px;"/></span>
                            </td>
                          </tr>

<!--                           <tr>
                            <td style="text-align:left">Slice representation 
                            </td>

                            <td style="text-align:left">
                              <label class="checkbox" style="margin:0">
                                <input type="checkbox" value="slice" class="SliceDisplay" style="margin-left:40px;margin-top:0,margin-bottom:0">
                              </label>
                            </td>
                          </tr> -->

                          <!-- MAPTYPES -->
                          <tr>
                            <td style="text-align:left">Map style</td>
                            <td style="text-align:left">
                              <select id="WatermapType"data-map="occupancy" style="padding:0;font-size:14px;margin:1px">   
                                 <option value="smooth">Smooth</option>
                                 <option value="wireframe">Wireframe</option>
                                 <option value="flat">Flat</option>
                                 <option value="contour">Contour</option>

                              </select>
                            </td>

                          </tr>
                                                    <!-- COLOR slider -->

<!--                             <tr>
                            <td style="text-align:left">Color</td>
                            <td style="text-align:left">
                              <center>
                                <div class="color_volmap"  style="max-width:150px;display:inline-block;float:left;margin-left:20px">
                                  <input type="color" name="favcolor" value="#ff0000" id=choose_color>
                                  <button class=button_color_water id="select_color_water" style= 'font-size:10px;text-align:center;vertical-align:middle; display:table-cell; margin:auto;padding:0px'> select </button>
                                </div>
                              </center>
                            </td>
                          </tr> -->

                          <!-- Opacity slider -->
                          <tr>
                            <td style="text-align:left">Opacity</td>
                            <td style="text-align:left">
                              <center>
                                <div class="slider_volmap"  style="max-width:150px;display:inline-block;float:left;margin-left:-30px">
                                  <input class="slider_volmap" data-valtype="transparency" data-map="occupancy" value="0.5" min="0" max="1" step="0.1" type="range">
                                </div>
                                <div class="slider_val" id="slider_val_trans" style="width:20px;display:inline;float:left">1</div>
                              </center>
                            </td>
                          </tr>

                          <!-- Smoothness slider -->
                          <tr>
                            <td style="text-align:left">Smoothness</td>
                            <td style="text-align:left">
                              <center>
                                <div class="slider_volmap"  style="max-width:150px;display:inline-block;float:left;margin-left:-30px">
                                  <input class="slider_volmap" data-valtype="smoothness" data-map="occupancy" value="1" min="0" max="10" step="0.5" type="range">
                                </div>
                                <div class="slider_val" id="slider_val_smooth" style="width:20px;display:inline;float:left">10</div>
                              </center>
                            </td>
                          </tr>

 
                          <!-- ISOLEVEL slider -->
                          <tr>
                            <td style="text-align:left">ISO level</td>
                            <td style="text-align:left">
                              <center>
                                <div class="slider_volmap"  style="max-width:150px;display:inline-block;float:left;margin-left:-30px">
                                  <input class="slider_volmap" data-valtype="isolevel" data-map="occupancy" value="0.3" min="0" max="1" step="0.01" type="range">
                                </div>
                                <div class="slider_val" id="slider_val_occupancy" style="width:20px;display:inline;float:left">1</div>
                              </center>
                            </td>
                          </tr>

                          <tr>
                            <td style="text-align:left">Show Polar residues</td>

                            <td style="text-align:left">
                              <label class="checkbox" style="margin:0">
                                <input type="checkbox" value="polar" class="PolarDisplay" style="margin-left:40px;margin-top:0,margin-bottom:0">
                              </label>
                            </td>
                          </tr>

                          

                            <tr>
                            <span class='waterdistance'>
                            <td style="text-align:left;margin-left:200px">
                            <label class="checkbox" style="margin:0px">
                                <input type="checkbox" value="showwaterdist" class="WaterDistDisplay" style="margin-left:0px;margin-top:0,margin-bottom:0">
                            </label>
                              <div style="margin-left:30px" > Show waters within </div>
                          </td>
                        </span>

                              <td style="text-align:left">
                                <span id="waterswithin_parent" >
                                <input class="form-control waterswithin" id='waterswithin'type="text" style="width:40px;height:25px;padding-left:15px;margin-left:25px">
                                Å of protein
                                </span>
                            </td>
<!--                             </span> -->
                            </tr>


                      </tbody>
                    </table>
              </div>
            </div>
          </div>

            {% endif %}
<!-- ============= Pharmacophores =========== --> 
          {% if has_pharmacophores %}
          <div class="row" >
            <div class="section_pan" data-toggle="collapse" data-target="#analysis_pharmacophores" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" >
              <span> Dynamic pharmacophores </span>
              <span id="loading_display_pharmacophores" style="display:none"><img src="{% static 'view/images/loading-gear.gif' %}" style="width:17px;height:17px;"/></span>
              <span style="float:right;margin-right:5px;" class="glyphicon {% if pharmacophore_def %}glyphicon-chevron-up{% else %}glyphicon-chevron-down{% endif %} arrow"></span>
            </div>
          </div>
          <div id="analysis_pharmacophores" data-has_itypes="{{pharma_json}}" class="collapse {% if pharmacophore_def %}in{% endif %}" data-occupancy_data="{{occupancy}}">
            <div class="row" style="margin-top:10px;margin-bottom:15px;margin-left:5px">
              <div style="margin-left:0;padding-left:0;" class="col-md-2">Display:</div>
              <div  class="col-md-6">
                  <label class="checkbox" style="margin:0px">
                    <input type="checkbox" value="showwaterdist" class="pharmacheck" {% if pharmacophore_def %}checked{% endif %} id='pharmalig' style="margin-left:0px;margin-top:0,margin-bottom:0">
                  </label>
                  <div style="margin-left:30px">Ligand pharmacophores</div>                    
                  <label class="checkbox" style="margin:0px">
                    <input type="checkbox" value="showwaterdist" class="pharmacheck" {% if pharmacophore_def %}checked{% endif %} id='pharmarec' style="margin-left:0px;margin-top:0,margin-bottom:0">
                  </label>
                  <div style="margin-left:30px">Receptor pharmacophores</div>                                    
              </div>
            </div>
            <div class="row" style="margin-top:10px;margin-bottom:15px;margin-left:5px">
              <div style="margin-left:0;padding-left:0;" class="col-md-2">Interaction type</div>
              <div class="col-md-6">
                <select id='pharmaitype_selector'>
                  <option {% if not pharmacophore_def %}selected="true"{% endif %} class='pharmaitype' value="hb">Hydrogen bonds (all)</option>
                  <option class='pharmaitype' value="hbls">Hydrogen bonds (sidechain atoms)</option>
                  <option class='pharmaitype' value="hblb">Hydrogen bonds (backbone atoms)</option>
                  <option class='pharmaitype' value="wb">Water bridge</option>
                  <option class='pharmaitype' value="wb2">Extended water bridge</option>
                  <option class='pharmaitype' value="vdw">Van der waals</option>
                  <option {% if pharmacophore_def %}selected="true"{% endif %} class='pharmaitype' value="all">All types</option>
                </select>
              </div>
            </div>
            <div class="row" style="margin-top:10px;margin-bottom:15px;margin-left:5px">
              <div style="margin-left:0;padding-left:0;" class="col-md-2">Color pattern</div>
              <div class="col-md-6">
                <select id="pharmacolor_selector">
                  <option selected="true" class="pharmacolor" value="element">By element</option>
                  <option class="pharmacolor" value="partner">By pharmacophore</option>                    
                </select> 
              </div>
            </div>
          </div>
          {% endif %}
<!-- ============= Tunnels  =========== --> 

          {% if tunnels %}
          <div class="row">
            <div class="section_pan" data-toggle="collapse" data-target="#analysis_tunnels" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;" ><span>Tunnels and channels </span><span style="float:right;margin-right:5px;" class="glyphicon {% if tunnels_channels_def %}glyphicon-chevron-up{% else %}glyphicon-chevron-down{% endif %} arrow"></span>
            </div>
          </div>
          <div id="analysis_tunnels" class="row collapse {% if tunnels_channels_def %}in{% endif %}" data-tunnels="{{tunnels_dump}}" data-tunnels_radius="{{tunnels_radius}}"  data-tun_clust_rep_avail="{{tun_clust_rep_avail|json_dump}}" data-traj_clust_rad="{{traj_clust_rad}}">
            <div class="" style="margin-top:10px;margin-bottom:15px">
              <div style="margin-right:5px;margin-left:14px;margin-bottom:15px">
                {% if tunnels|get_item:traj_list.0.2 %}

                <table class="table" style="font-size:14px" id="tunnel_options" >
                  <thead>
                    <tr style="background-color:#f3f3f3">
                      <th></th>
                      <th style="text-align:center">Clusters</th>
                      {% if tun_clust_rep_avail %}
                      <th style="text-align:center" >Highest throughput 
                          <span id="tun_repr_tooltip" title="Tunnel or channel of the cluster with highest throughput (probability of being used as a route for transportation). The tunnel is found at the frame indicated." class="glyphicon glyphicon-info-sign" data-toggle="tooltip" style="cursor: default;font-size:12px" ></span>
                      </th>
                      {% endif %}
                    </tr>
                  </thead>
                  <tbody>
                    <tr style="background-color:#FCFCFC">
                      <td></td>
                      <td style="text-align:center">
                          <button type="button" class="btn btn-default btn-xs changefocus tun_display_btn show_all_tun {%if tunnels_channels_def%}active{% endif %}" data-target=".tun_cluster_display_clus" >Show<br>all</button>
                          <button type="button" class="btn btn-default btn-xs changefocus tun_display_btn hide_all_tun" data-target=".tun_cluster_display_clus">Hide<br>all</button>
                      </td>
                      {% if tun_clust_rep_avail %}
                      <td style="text-align:center">
                        <button type="button" class="btn btn-default btn-xs changefocus tun_display_btn show_all_tun"  data-target=".tun_cluster_display_repr">Show<br>all</button>
                        <button type="button" class="btn btn-default btn-xs changefocus tun_display_btn hide_all_tun" data-target=".tun_cluster_display_repr">Hide<br>all</button>
                      </td>
                      {% endif %}
                    </tr>
                    <tr style='background-color:#FCFCFC'>
                      <td  style="text-align:right;font-weight:bold">Style</td>
                      <td style="text-align:center">
                          <select class="form-control input-sm tun_display_style" data-target=".tun_cluster_display_clus" style="padding:0;font-size:14px;margin:1px">
                             <option {% if not tunnels_channels_def %}selected=""{% endif %} value="line">Line</option>
                             <option value="spacefill">Spacefill</option>
                             <option value="line+spacefill">Ball+stick</option>
                             <option value="licorice">Licorice</option>
                             <option {% if tunnels_channels_def %}selected=""{% endif %} value="surfaceWireframe">Surface wireframe</option>
                             <option value="surfaceOpaque">Surface opaque</option>
                             <!--<option value="surfacesummary">Summary</option>-->
                          </select>
                          <span id="loading_tun_style_clus" style="display:none"><img src="{% static 'view/images/loading-gear.gif' %}" style="width:17px;height:17px;"/></span>
                      </td>
                      {% if tun_clust_rep_avail %}
                      <td style="text-align:center">
                          -
                      </td>
                      {% endif %}
                    </tr>
                    <!--<tr style='background-color:#FCFCFC'>
                      <td  style="text-align:right;font-weight:bold">Opacity</td>
                      <td style="text-align:center">
                        <center>
                          <div class="" style="max-width:150px;display:inline-block">
                            <input id="slider_tunnel_clusters" class="slider slider_tunnel" data-tuntype="clust" value="100" min="0" max="100" step="1" type="range">
                          </div>
                          <div  id="slider_val_tunnel_clusters" class="slider_val_tunnel" style="width:20px;display:inline-block;color:#b3b3b3">100</div>
                        </center>
                      </td>
                      {% if tun_clust_rep_avail %}
                      <td style="text-align:center">
                        <center>
                          <div class="" style="max-width:150px;display:inline-block">
                            <input id="slider_tunnel_ht" class="slider slider_tunnel" data-tuntype="repr" value="100" min="0" max="100" step="1" type="range">
                          </div>
                          <div  id="slider_val_tunnel_ht" class="slider_val_tunnel" style="width:20px;display:inline-block;color:#b3b3b3">100</div>
                        </center>
                        </td>
                      {% endif %}
                    </tr>-->
                    {% for cluster in tunnels|get_item:traj_list.0.2 %}
                    <tr style="">
                      <td style="text-align:right;font-weight:bold">
                        <div style="width: 36px;float: right;">
                          <div style="float:left">
                            c{{ forloop.counter }}
                          </div>
                          <div style="float:right;display: block;margin: 7px 0 7px 7px">
                            <span style="height: 5px;width:5px;background-color:{{forloop.counter | tunnel_color_from_clusternum}};border-radius: 50%;display: inline-block;"></span>
                          </div>
                        </div>
                      </td>
                      <td style="text-align:center">
                        <label class="checkbox" style="margin:0">
                          <input  type="checkbox"  class="tun_cluster_display tun_cluster_display_clus" value="clustering_c{{ forloop.counter }}" style="margin-left:-5px;margin-top:0,margin-bottom:0" data-file_li="{{ cluster.0|json_dump }}" data-traj_id="{{traj_list.0.2}}">
                        </label>
                      </td>
                      {% if tun_clust_rep_avail %}
                      <td style="padding:0 0 5px 0" >
                        <center>
                          <div style="width:100px">
                            <div style="float:left;top:-10px;width:20px;padding-top:5px">
                                <label class="checkbox" style="margin:0">
                                  <input  type="checkbox"  class="tun_cluster_display tun_cluster_display_repr" value="repr_c{{ forloop.counter }}" style="margin-left:-5px;margin-top:0,margin-bottom:0;display:block;position:relative" data-traj_id="{{traj_list.0.2}}"  >
                                </label>
                            </div>
                          <div style="display:block;width:80px;float:left;margin-top:5px">
                            <button class="btn btn-default btn-xs display_rep_tunnel_fr" type="button" style="width:80px" data-frameNum='{{ cluster.1.1 }}'>
                              Display<br>frame {{ cluster.1.1 }}
                            </button>
                           </div>
                          </div>
                        </center> 
                      </td>
                      {% endif %}
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>

                {% else %}
                <div class="alert alert-info" style="margin:30px 0;">
                  No results found for this trajectory. Please select a different trajectory.
                </div>
                {% endif %}

              </div>
            </div>
          </div>
          {% endif %}

<!-- ============= Pockets  =========== -->

    {% if pockets %}
    <div class="row">
      <div id="analysis_pockets_pan" class="section_pan" data-toggle="collapse" data-target="#analysis_pockets" style="cursor:pointer; padding:10px 10px 5px 10px; background-color: #ffffff; border-bottom: 1px solid #337ab7;border-radius:0;">
        <span>Pockets</span>
        <span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span>
      </div>
    </div>

<!-- Table -->

    <div id="analysis_pockets" class="row collapse" data-pockets="{{pockets_dump}}">
      <div style="margin-top:10px;margin-bottom:15px;margin-left:25px">

        <div class="row" style="margin-top:20px">
          <div class="col-md-8">
            <button id="pocket_plot_button" type="button" class="btn btn-primary" style="padding:2px 5px 2px 5px; width: 100%; height: 34px">Plot and view selected pockets</button>
          </div>
          <div class="col-md-4">
            <button id="reset_pocket_plot" type="button" class="btn btn-default" style="padding:2px 5px 2px 5px; width: 100%; height: 34px">Reset</button>
          </div>
        </div>

        <div class="row" style="margin-top:20px">
          <div class="col-md-4">
            <span style="margin-right: 1em">Show nearby residues?</span>
            <input id="show_nearby_residues" class="form-check-input" type="checkbox" style="height: 20px; width: 20px">
          </div>
          <div class="col-md-6">
            <span>Smoothing window size:</span>
            <input id="smoothing_window_size" type="number" class="form-control" style="width:7em" name="smoothing_window_size" min="1" value="10" size="5"> 
          </div>
          <div class="col-md-2">
            <a id="download_pockets_pdbs" download href="" class="btn btn-default" style="height: 34px">
              <span class="glyphicon glyphicon-download-alt"></span>
            </a>
          </div>
        </div>

        <hr style="width:80%;border-color:lightblue;">

        <div class="row" style="margin-top:20px">
          <table id="analysis_pockets_table" class="display compact smalltable">
            <thead>
              <tr>
                <th>Pocket number</th>
                <th>Color</th>
                <th>Mean volume</th>
                <th>Avg. Polarity</th>
                <th>Avg. Hydroph. Density</th>
                <th>Avg. Hydroph. Score</th>
                <th>Druggability %</th>
              </tr>
            </thead>
            <tbody>
<!-- Now this is dynamically created -->
<!--               {% for key, value in pockets.items %}
                {% if key == traj_list.0.2 %}
                  {% for data, descript in value.items %}
                    {% for descriptor in descript %}
                      <tr>
                        <td>{{ descriptor.name }}</td>
                        <td>
                          <span style="height:20px;width:20px;background-color:{{ descriptor.name | tunnel_color_from_clusternum }};border-radius: 50%;display: inline-block;"></span>
                        </td>
                        <td>{{ descriptor.average_volume }}</td>
                        <td>{{ descriptor.average_hydrophobicity_Density }}</td>
                      </tr>
                    {% endfor %}
                  {% endfor %}
                {% endif %}
              {% endfor %} -->
            </tbody>
          </table>
        </div>
      </div>

      <hr style="width:80%;border-color:lightblue;">

      <div class="row" style="margin-top:20px">
        <div id="pocket_plot"></div>
      </div>

    </div>
    {% endif %}

  <!-- ============= Genetic variants =========== --> 
    {% if pdb_vars|length > 2 %}
    <div class="row">
        <div id="analysis_variants_pan" class="section_pan" data-toggle="collapse" data-target="#analysis_variants" style="cursor:pointer;padding:10px 10px 5px 10px;background-color:#ffffff;border-bottom:1px solid #337ab7;border-radius:0;">
          <span>Genetic variants </span>
          <span style="float:right;margin-right:5px;" class="glyphicon glyphicon-chevron-down arrow"></span>
        </div>
    </div>
    <div id="analysis_variants" class="row collapse ">
      <div style="margin-top:10px;margin-bottom:15px;margin-left:25px">

        <div class="row" style="margin-top:20px">
          <div class="col-md-2">
            <span>Display</span>
            <div class="btn-group btn-group-xs">
            <button id="analysis_variants_display_on" type="button"  class="btn btn-default analysis_variants_display" data-action="on" style="padding:2px 5px 2px 5px;">On</button>
            <button id="analysis_variants_display_off" type="button"  class="btn btn-default analysis_variants_display active" data-action="off" style="padding:2px 5px 2px 5px;">Off</button>
            </div>
          </div>
          <div class="col-md-6 text-center">
            <span>Color by:</span>
            <select id="variant_color_by" class="form-select" autocomplete="off"> <!-- autocomplete="off" to reset when F5 -->
                <option value="totalDiseases" selected="selected">Disease association</option>
                <option value="UIP">Unified Impact Prediction</option>
                <option value="Role">Functional site</option>
                <option value="Modified Residue">Post-translational modification</option>
                <option value="SIFT score">SIFT score</option>
                <option value="Polyphen-2 score">PolyPhen score</option>
                <option value="MutationType">Mutation type (similar or changed)</option>
            </select>
          </div>
          <div class="col-md-4">
            <div>
              <span>Show every atom: </span>
              <input id="is-licorice" class="form-check-input" type="checkbox">
            </div>
            <div>
              <span>Top disease label: </span>
              <input id="is-disease-label" class="form-check-input" type="checkbox">
            </div>
          </div>
        </div>

        <div id="variant-legend" class="row" style="margin-top:20px; border-style:solid; border-width: 1px;padding: 10px; border-color: lightblue; display: none">
    <!--                <div style="display:flex">
            <span style="margin-right:10px;">An example tag:</span>
            <div style="width:20px;height:20px;background-color:red;border-radius:50%;"></div>
          </div> -->
        </div>


        <hr style="width:80%;border-color:lightblue;">

        <div class="row text-center" style="margin-bottom:10px">
          <button id="filter_only_disease" type="button" class="btn btn-default variant_filter_button" style="padding:2px 5px 2px 5px;">
            <img src="https://www.disgenetplus.com/images/logo_disgenet_plus.png" style="height:2em; margin-right:1em">
            <span>Show only disease-associated variants</span>
          </button>
        </div>

        <div class="row text-center" style="margin-bottom:10px">
          <span style="margin-right:9px;">Filter by aminoacid change:</span>
          <select id="filter_aa_change" class="form-select" autocomplete="off" style="width:200px"> <!-- autocomplete="off" to reset when F5 -->
            <option value="" selected="selected">No filter</option>
            <option value="changed">Changed</option>
            <option value="similar">Similar</option>
          </select>
        </div>

        <div class="row text-center" style="margin-bottom:10px">
          <span style="margin-right:37px;">Filter by functional site:</span>
          <select id="filter_functional_site" class="form-select" autocomplete="off" style="width:200px"> <!-- autocomplete="off" to reset when F5 -->
            <option value="" selected="selected">No filter</option>
            <option value="Intracellular binding site">Intracellular binding site</option>
            <option value="CM: Na binding site">CM: Na binding site</option>
            <option value="CM: ionic lock">CM: ionic lock</option>
            <option value="Binding site">Binding site</option>
          </select>
        </div>

        <div class="row text-center" style="margin-bottom:10px">
          <span style="margin-right:19px;">Filter by predicted impact:</span>
          <select id="filter_predicted_impact" class="form-select" autocomplete="off" style="width:200px"> <!-- autocomplete="off" to reset when F5 -->
            <option value="" selected="selected">No filter</option>
            <option value="Damaging">Damaging</option>
            <option value="Damaging|Indef.">Damaging + undefined</option>
            <option value="Indef.">Undefined</option>
            <option value="Benign">Benign</option>
          </select>
        </div>

        <hr style="width:80%;border-color:lightblue;">

        <div class="row" style="overflow:auto;margin-top:10px">
          <table id="analysis_variants_table" class="display compact smalltable" style="display:none" >
            <thead>
                <tr>
                  <th></th>
                  <th>Position</th>
                  <th>GPCRdb num</th>
                  <th>Variant</th>
                  {% for datad in var_info_data %}
                  <th class="basictooltip" data-toggle="tooltip" title="{{datad.description}}">
                    {{datad.name}}
                  </th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for pdbpos, pos_vdata in pdb_vars_templ|sort_dict_by_key_pos %}
                  {% for fromto, var_li in pos_vdata.vars.items %}
                    {% for vardata_dict in var_li %}
                    <tr  >
                      <td><span class="glyphicon glyphicon-zoom-in my_glyphicon_btn zoom_to_nglsel" data-nglsel="{{pdbpos}}"></span></td>
                      <td>
                        {% with pdbpos|split_by:":" as a %}
                          {{a.0}}
                        {% endwith %}

                      </td>
                      <td>{{pos_vdata.gnum}}</td>  
                      <td>{{ fromto|replace:",| - " }}</td>  
                      {% for datad in var_info_data %}
                        <td >
                          {% with vardata_dict|get_item:datad.id as vardata_val%}
                            {% if datad.is_dict %}
                              {% for k,v in vardata_val.items %}
                                <span class="basictooltip" data-toggle="tooltip" title="{{k}}">{{v}}</span>
                              {% endfor %}
                            {% elif datad.multiple_options %}
                              {% if vardata_val|to_lowercase == datad.multiple_options.show_if_val %}
                                {% if datad.id == "Disease" %}
                                    <a class="basictooltip" data-toggle="tooltip"
                                      href="https://www.disgenet.org/browser/2/1/1/{{var_li.0|get_item:var_info_data.0.id}}"
                                      title="VDA =
                                        {% with datad.multiple_options.ids.2 as opt_id%}
                                          {{vardata_dict|get_item:opt_id}}
                                        {% endwith %}
                                      ">
                                      {% with datad.multiple_options.ids.0 as opt_id%}
                                        {{vardata_dict|get_item:opt_id}}
                                      {% endwith %}
                                    </a>
                                {% else %}
                                  {% for opt_id in datad.multiple_options.ids %}
                                      {% with vardata_dict|get_item:opt_id as in_value%}
                                        {% if in_value %}
                                          <span class="basictooltip" data-toggle="tooltip" title="{{in_value}}">{{opt_id}}</span>
                                        {% endif %}
                                      {% endwith %}
                                  {% endfor %}
                                {% endif %}
                              {% endif %}
                            {% else %}
                              {% if datad.is_href %}
                                <a href="{{datad.is_href}}{{vardata_val}}">{{vardata_val}}</a>
                              {% else %}
                                {{vardata_val}}
                              {% endif %}
                            {% endif %}
                          {% endwith %}
                        </td>
                      {% endfor %}
                    </tr>
                    {% endfor %}
                  {% endfor %}
                {% endfor %}
              </tbody>
          </table>
        </div>

        <div class="row" style="margin-top:10px">
          <div id="variant_columns_shown" class="btn-group btn-group-xs">
            <button type="button" class="btn btn-default active" data-column="1">Position</button>
            <button type="button" class="btn btn-default active" data-column="2">GPCRdb num</button>
            <button type="button" class="btn btn-default active" data-column="3">Variant</button>
            {% for datad in var_info_data %}
              <!-- List of values should be the same as specified in DataTable JS (emb_ngl_viewer.js) -->
              {% if forloop.counter|add:3|stringformat:"i" in "0,1,2,4,5,9,12,14,15" %}
                <button type="button" class="btn btn-default active" data-column="{{forloop.counter|add:3}}">{{datad.name}}</button>
              {% else %}
                <button type="button" class="btn btn-default" data-column="{{forloop.counter|add:3}}">{{datad.name}}</button>
              {% endif %}
            {% endfor %}
          </div>
        </div>

        <div class="row" style="margin-bottom:10px">
            <a role="button" id="downl_json_hb" class="btn btn-link settingsB disablewhencomp" href="/dynadb/files/Precomputed/muts_vars_info/gpcr_vars.json" style="color: rgb(88, 88, 88); margin-top: 15px; padding: 0px;" target="_blank">                      
              <span title="" class="glyphicon glyphicon-download-alt"></span>Download
            </a>
        </div>

      </div>

    </div>
    {% endif %}

<!-- ============= Chemical Shift (CS) (temporarely silcenced) =========== --> 
          {% if dyn_id %} 
          {% else %}
          <div class="row">
            <div id="analysis_cs_pan" class="section_pan check_if_cs_struc" data-toggle="collapse" data-target="#analysis_cs"><span>Chemical Shift (CS)</span><span class="arrow_down glyphicon glyphicon-chevron-down arrow"></span>
            </div>
          </div>
          <div id="analysis_cs" class="row collapse" data-aa3to1="{{aa3to1}}" data-resid_to_resname="{{resid_to_resname}}" data-residnames="{{cs_resid_name}}">
            <div style="margin-top:10px;margin-bottom:15px;margin-left:5px">
              <p class="cs_title">Predictor</p>
              <label for="cs_shifty" class="cs_option">
                <input type="radio" id="cs_shifty" name="cs_pred" class="cs_pred" value="" checked> SHIFTX2
              </label>
              <label for="cs_sparta" class="cs_option">
                <input type="radio" id="cs_sparta" name="cs_pred" class="cs_pred" value="sparta_" {% if cs_sparta_avail == False %} disabled{% endif %}> SPARTA+
              </label>
              <p class="cs_title">Analysis type</p>
              <div id="cs_menus">
                <ul id="cs_atypes" class="nav nav-tabs tab_list">
                  <li id="cs_atype_tab_satom" value="satom" class="active" ><a data-toggle="tab" href="#cs_atype_satom">Streaming CS</a></li>
                  <li id="cs_atype_tab_comp" value="comp" class=""><a data-toggle="tab" href="#cs_atype_comp">Mean CS</a></li>
                  <li id="cs_atype_tab_2d" value="2d" class="" ><a data-toggle="tab" href="#cs_atype_2d">Two-dimensional CS</a></li>
                </ul>
                <div class="tab-content">

                  <div id="cs_atype_comp" class="tab-pane fade">
                    <p class="cs_title"> Selection type:</p>
                    <ul class="nav nav-tabs tab_list">
                      <li id="cs_comp_tab_predef" class="active"><a data-toggle="tab" href="#cs_comp_predef">Predefined</a></li>
                      <li id="cs_comp_tab_custom"><a data-toggle="tab" href="#cs_comp_custom">Custom</a></li>
                    </ul>

                    <div class="tab-content">
                      <div id="cs_comp_predef"class="btnsel_div tab-pane fade in  active">
                        <button id="metsel" type="button" data-plotype="comp" data-atom1="HE" data-atom2="CE" data-resname="MET" class="btn-default predef_btn btn btn-square-md" style="background-image: url({% static 'view/images/custom_met.png' %})"></button>
                        <button id="alasel" type="button" data-plotype="comp" data-atom1="HB" data-atom2="CB" data-resname="ALA" class="btn-default predef_btn btn btn-square-md" style="background-image: url({% static 'view/images/custom_ala.png' %})"></button>
                        <button id="ilesel"type="button" data-plotype="comp" data-atom1="HD1" data-atom2="CD1" data-resname="ILE" class="btn-default predef_btn btn btn-square-md" style="background-image: url({% static 'view/images/custom_ile.png' %})"></button>
                      </div>
                      <div id="cs_comp_custom" class="tab-pane fade in">

                        <ul class="nav nav-tabs tab_list">
                          <li id="cs_comp_tab_free" class="cs_comp_tab_li active"><a data-toggle="tab" href="#cs_comp_free">From coordinates</a></li>
                          <li id="cs_comp_tab_structure" class="cs_tab_structure cs_comp_tab_li check_if_cs_struc" ><a data-toggle="tab" href="#cs_comp_structure">From structure</a></li>
                        </ul>

                        <div class="tab-content">
                          <div id="cs_comp_free" class="tab-pane fade in active">
                            <table class="table table-condensed table-borderless" >
                              <tbody>
                                {% for cs_opt in cs_selection_params.residue %}
                                <tr>
                                  <td>{{cs_opt.name}}</td>
                                  <td>
                                    {% include "view/dropdown_w_selector.html" with option_list=cs_opt.options type='resid' ref="comp"|add:cs_opt.ref mul=True  %}
                                  </td>
                                </tr>
                                {% endfor %}
                              </tbody>
                            </table>
                          </div>
                          <div id="cs_comp_structure" class="tab-pane fade">
                            <div class="well" style="padding:5px 10px;height:100px;overflow:auto">
                              <div class="info_text" style="margin:0">
                                <p>Click on the GPCR structure to select residues.</p>
                              </div>
                              <span id="cs_comp_struc_options"></span>
                              <button id="cs_comp_struc_clear"  class="btn btn-link clear_auto" data-target="#cs_comp_struc_options" data-datatype="cs" data-hide_btn="true">Clear</button>  
                            </div>
                          </div>
                        </div>
                        <table class="table table-condensed table-borderless" >
                          <tbody>
                            {% for cs_opt in cs_selection_params.atom %}
                            <tr>
                              <td>{{cs_opt.name}}</td>
                              <td>
                                {% include "view/dropdown_w_selector.html" with type='atom' option_list=cs_opt.options ref=cs_opt.ref mul=True %}
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>

                    <div>
                      <button type="button" id="cs_apply_comp" class="cs_apply btn btn-success btn-sm" value="comp">Apply changes</button>
                      <a download href="/dynadb/files/Dynamics/" class="btn btn-default cs_download_raw">
                        <span class="glyphicon glyphicon-download-alt"></span> CS raw data
                      </a>
                      <a download href="/dynadb/files/Dynamics/" class="btn btn-default cs_download_simp">
                        <span class="glyphicon glyphicon-download-alt"></span> CS simplified data
                      </a>
                      <p>  </p>
                    </div>

                    <span class="cs_loading" ><center ><img class="img_csloading" src="{% static 'view/images/loading-gear.gif' %}"/></center></span>
                    <div id="cs_chart_comp">
                    </div>
                    <div id="error_cs_comp" class="error_cs alert alert-danger" style="margin:10px 0; display: none;">
                      An unexpected error occurred.
                    </div>

                  </div>

                  <!-- Single-atom CS plots -->
                  <div id="cs_atype_satom" class="tab-pane fade in active" data-resid="" data-aname="">
                    <ul class="nav nav-tabs tab_list">
                      <li id="cs_satom_tab_free" class="cs_satom_tab_li active"><a data-toggle="tab" href="#cs_satom_free">From coordinates</a></li>
                      <li id="cs_satom_tab_structure" class="cs_tab_structure cs_satom_tab_li check_if_cs_struc" ><a data-toggle="tab" href="#cs_satom_structure">From structure</a></li>
                      <!--<li id="cs_comp_tab_sequence" class="cs_comp_tab_li"><a data-toggle="tab" href="#cs_comp_sequence">Sequence</a></li>-->
                    </ul>

                    <div class="tab-content">
                      <div id="cs_satom_free" class="tab-pane fade in active">
                        <table class="table table-condensed table-borderless" >
                          <tbody>
                            {% for cs_opt in cs_selection_params.residue %}
                            {% if cs_opt.ref == "resid" %}
                            <tr>
                              <td>{{cs_opt.name}}</td>
                              <td>
                                {% include "view/dropdown_w_selector.html" with option_list=cs_opt.options type='resid' ref="sresid" mul=False %}
                              </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                            {% for cs_opt in cs_selection_params.atom %}
                            <tr>
                              <td>{{cs_opt.name}}</td>
                              <td>
                                {% include "view/dropdown_w_selector.html" with option_list=cs_opt.options type='atom' ref="satom" mul=False %}
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                      <div id="cs_satom_structure" class="tab-pane fade">
                        <div class="well" style="padding:5px 10px;height:100px;overflow:auto">
                          <div class="info_text" style="margin:0">
                            <p>Click on the GPCR structure to select atoms.</p>
                          </div>
                          <span id="cs_satom_struc_options"></span>
                          <button id="cs_satom_struc_clear"  class="btn btn-link clear_auto" data-target="#cs_satom_struc_options" data-datatype="cs" data-hide_btn="true">Clear</button>  
                        </div>
                      </div>
                    </div>
                    <div>
                      <button type="button" id="cs_apply_satom" class="cs_apply btn btn-success btn-sm" value="satom">Apply changes</button>
                      <a download href="/dynadb/files/Dynamics/" class="btn btn-default cs_download_raw">
                        <span class="glyphicon glyphicon-download-alt"></span> CS raw data
                      </a>
                      <a download href="/dynadb/files/Dynamics/" class="btn btn-default cs_download_simp">
                        <span class="glyphicon glyphicon-download-alt"></span> CS simplified data
                      </a>
                      <p>  </p>                        
                    </div>

                    <span class="cs_loading"><center ><img class="img_csloading" src="{% static 'view/images/loading-gear.gif' %}"/></center></span>
                    <div id="cs_chart_satom">
                    </div>
                    <div id="error_cs_satom" class="error_cs alert alert-danger" style="margin:10px 0; display: none;">
                      An unexpected error occurred.
                    </div>

                  </div>
                  
                  <div id="cs_atype_2d" class="tab-pane fade">
										
										<label class="nobold">
										  <input type="checkbox" id='cs_solution' name="cs_solution">
										  Solution NMR prediction
										  <span class="info_icon glyphicon glyphicon-info-sign" data-toggle="tooltip" title="Converts signals into a single distribution." ></span>
										</label>

                    <p class="cs_title"> Selection type:</p>
                    <ul class="nav nav-tabs tab_list">
                      <li id="cs_2d_tab_predef" class="active"><a data-toggle="tab" href="#cs_2d_predef">Predefined</a></li>
                      <li id="cs_2d_tab_custom"><a data-toggle="tab" href="#cs_2d_custom">Custom</a></li>
                    </ul>

                    <div class="tab-content">

                      <div id="cs_2d_predef"class="btnsel_div tab-pane fade in active">
                        <button id="metsel" type="button" data-plotype="2d" data-atom1="HE" data-atom2="CE" data-resname="MET" class="btn-default predef_btn btn btn-square-md" style="background-image: url({% static 'view/images/custom_met.png' %})"></button>
                        <button id="alasel" type="button" data-plotype="2d" data-atom1="HB" data-atom2="CB" data-resname="ALA" class="btn-default predef_btn btn btn-square-md" style="background-image: url({% static 'view/images/custom_ala.png' %})"></button>
                        <button id="ilesel"type="button" data-plotype="2d" data-atom1="HD1" data-atom2="CD1" data-resname="ILE" class="btn-default predef_btn btn btn-square-md" style="background-image: url({% static 'view/images/custom_ile.png' %})"></button>
                      </div>
                      <div id="cs_2d_custom" class="tab-pane fade in">
                        <ul class="nav nav-tabs tab_list">
                          <li id="cs_2d_tab_free" class="cs_2d_tab_li active"><a data-toggle="tab" href="#cs_2d_free">From coordinates</a></li>
                          <li id="cs_2d_tab_structure" class="cs_tab_structure cs_2d_tab_li check_if_cs_struc" ><a data-toggle="tab" href="#cs_2d_structure">From structure</a></li>
                        </ul>

                        <div class="tab-content">
                          <div id="cs_2d_free" class="tab-pane fade in active">
                            <table class="table table-condensed table-borderless" >
                              <tbody>
                                {% for cs_opt in cs_selection_params.residue %}
                                <tr>
                                  <td>{{cs_opt.name}}</td>
                                  <td>
                                    {% include "view/dropdown_w_selector.html" with option_list=cs_opt.options type='resid' ref="2d"|add:cs_opt.ref mul=True  %}
                                  </td>
                                </tr>
                                {% endfor %}
                              </tbody>
                            </table>
                          </div>
                          <div id="cs_2d_structure" class="tab-pane fade">
                            <div class="well" style="padding:5px 10px;height:100px;overflow:auto">
                              <div class="info_text" style="margin:0">
                                <p>Click on the GPCR structure to select residues.</p>
                              </div>
                              <span id="cs_2d_struc_options"></span>
                              <button id="cs_2d_struc_clear"  class="btn btn-link clear_auto" data-target="#cs_2d_struc_options" data-datatype="cs" data-hide_btn="true">Clear</button>  
                            </div>
                          </div>
                        </div>
                        <table class="table table-condensed table-borderless" >
                          <tbody>
                            <tr>
                              <td>X-axis atom type</td>
                              <td>Y-axis atom type</td>
                            </tr>
                            {% for cs_opt in cs_selection_params.atom %}
                            <tr>
                              <td>
                                {% include "view/dropdown_w_selector.html" with option_list=cs_opt.options type='atom' ref="2datom1" mul=False %}
                              </td>
                              <td>
                                {% include "view/dropdown_w_selector.html" with option_list=cs_opt.options type='atom2' ref="2datom2" mul=False %}
                              </td>
                            </tr>
                            {% endfor %}
                            <tr>
                              <div id="same_atom_name" class="alert alert-warning">
                                <p>For these plot to work, two different types of atom must be selected</p>
                              </div>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>

                    <table class="table table-condensed table-borderless" >
                      <tbody>
                        <tr>
                          <td>Frames: </td>
                          <td>
                            <input type="radio" id='all_frames' class="cs_frames" name="cs_frames" value="all_frames" checked> All
                          </td>
                        </tr>
                        <tr>
                          <td></td>  
                          <td>
                            <input type="radio" id='sel_frames' class="cs_frames" name="cs_frames" value="selected_frames"> 
                            From 
                            <span id="bonds_frame_1_par">
                              <input class="form-control input-sm rvSpaces maxinp8 changeVal cs_frames_input" readonly id="cs_frames_start" type="text">
                            </span>
                            to 
                            <span id="bonds_frame_2_par">
                              <input class="form-control input-sm rvSpaces maxinp8 changeVal cs_frames_input" readonly id="cs_frames_end" type="text">
                            </span>
                          </td>          
                        </tr>
                      </tbody>
                    </table>

                    <div>
                      <button type="button" id="cs_apply_2d" class="cs_apply btn btn-success btn-sm" value="2d">Apply changes</button>
                      <a download href="/dynadb/files/Dynamics/" class="btn btn-default cs_download_raw">
                        <span class="glyphicon glyphicon-download-alt"></span> CS raw data
                      </a>
                      <a download href="/dynadb/files/Dynamics/" class="btn btn-default cs_download_simp">
                        <span class="glyphicon glyphicon-download-alt"></span> CS simplified data
                      </a>
                      <p></p>
                    </div>

                    <span class="cs_loading" ><center ><img class="img_csloading" src="{% static 'view/images/loading-gear.gif' %}"/></center></span>
                    <div id="cs_chart_2d">
                    </div>
                    <div id="error_cs_2d" class="error_cs alert alert-danger" >
                      An unexpected error occurred.
                    </div>
                  </div>

                </div>
              </div>

            </div>              
          </div>
          {% endif %}

<!-- ============= Allosteric communication (ac) (temporarely silenced) =========== --> 
          {% if dyn_id %} 
          {% else %}
          <div class="row">
            <div id="analysis_ac_pan" class="section_pan" data-toggle="collapse" data-target="#analysis_ac">
              <span>Allosteric communication (AC)</span><span class="arrow_down glyphicon {% if test_cs %}glyphicon-chevron-up{% else %}glyphicon-chevron-down{% endif %} arrow"></span>
            </div>  
          </div>
          <form id="ac_form" method="post" >
            {% csrf_token %}
            <div id="analysis_ac" class="row collapse {% if test_cs %}in{% endif %}">

              <div class="container-fluid">

                <div class="col-md-6">
                  <div class="container-fluid">
                    <p>
                      <b>Metric, residue information and method to use </b>
                    </p>
                    {% for opt, subs in ac_options.items%}
                    <div class="row ac_menu ac_base_menu dropdown">
                      <button id="{{opt}}" class="ac_btn btn btn-primary dropdown-toggle" data-for="{{opt}}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {{ ac_options_codes|get_value:opt }} <span class="caret"></span>
                      </button>
                      <ul class="ac_menu dropdown-menu dropdown-menu-right">
                        {% if subs|is_list %}
                        {% for sub in subs %}
                        <li class="ac_li">      
                          <label for="{{opt}}_{{sub}}" class="ac_option ac_inoption" data-butt="{{opt}}">
                            <input id="{{opt}}_{{sub}}" type="radio" name="ac_option" value="{{opt}}_{{sub}}" required>
                            {{ ac_options_codes|get_value:sub }}
                          </label>
                        </li>
                        {% endfor %}  
                        {% else %}                    
                        {% for sub,subval in subs.items %}
                        <li class="dropdown-submenu ac_li">
                          <label data-for="{{opt}}_{{sub}}" class="ac_option dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> {{ ac_options_codes|get_value:sub }} <span class="caret caret-right"></span></label>
                          <ul id={{opt}}_{{sub}} class="ac_menu dropdown-menu dropdown-menu-right">
                            {% if subval|is_list %}
                            {% for sub2 in subval %}
                            <li class="ac_li">
                              <label for="{{opt}}_{{sub}}_{{sub2}}" class="ac_option ac_inoption" data-butt="{{opt}}">
                                <input id="{{opt}}_{{sub}}_{{sub2}}" type="radio" name="ac_option" value="{{opt}}_{{sub}}_{{sub2}}" required>
                                {{ ac_options_codes|get_value:sub2 }}
                              </label>
                            </li>
                            {% endfor %}
                            {% else %}
                            {% for sub2,sub2val in subval.items %}
                            <li class="dropdown-submenu ac_li">
                              <label data-for="{{opt}}_{{sub}}_{{sub2}}" class="ac_option dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ ac_options_codes|get_value:sub2 }} <span class="caret caret-right"></span></label>
                              <ul id="{{opt}}_{{sub}}_{{sub2}}" class="ac_submenu ac_menu dropdown-menu dropdown-menu-right">
                                {% if sub2val|is_list %}
                                {% for sub3 in sub2val %}
                                <li class="dropdown-submenu ac_li">
                                  <label class="ac_option ac_inoption" for="{{opt}}_{{sub}}_{{sub2}}_{{sub3}}" data-butt="{{opt}}">
                                    <input id="{{opt}}_{{sub}}_{{sub2}}_{{sub3}}" type="radio" name="ac_option" value="{{opt}}_{{sub}}_{{sub2}}_{{sub3}}" required>
                                    {{ ac_options_codes|get_value:sub3 }}
                                  </label>
                                </li>
                                {% endfor %}
                                {% else %}
                                {% for sub3,sub3val in sub2val.items %}
                                <li class="dropdown-submenu ac_li">
                                  <label data-for="{{opt}}_{{sub}}_{{sub2}}_{{sub3}}" class="ac_option dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ ac_options_codes|get_value:sub3 }} <span class="caret caret-right"></span></label>
                                  <ul id="{{opt}}_{{sub}}_{{sub2}}" class="ac_submenu ac_menu dropdown-menu dropdown-menu-right">
                                    {% for sub4 in sub3val %}
                                    <li class="dropdown-submenu ac_li">
                                      <label class="ac_option ac_inoption" for="{{opt}}_{{sub}}_{{sub2}}_{{sub3}}_{{sub4}}" data-butt="{{opt}}">
                                        <input id="{{opt}}_{{sub}}_{{sub2}}_{{sub3}}_{{sub4}}" type="radio" name="ac_option" value="{{opt}}_{{sub}}_{{sub2}}_{{sub3}}_{{sub4}}" required>
                                        {{ ac_options_codes|get_value:sub4 }}
                                      </label>
                                    </li>
                                    {% endfor %}
                                  </ul>
                                  {% endfor %}                                  
                                  {% endif%}
                                </li>
                              </ul>
                            </li>
                            {% endfor %}
                            {% endif %}
                          </ul>
                        </li>
                        {% endfor %}
                        {% endif %}
                      </ul>
                    </div>
                    {% endfor %}
                  </div>

                  <div id="ac_sel_opt" class="hidden_div">
                    <p id="ac_sel_opt_name"></p>
                  </div>

                </div>

                <div class="col-md-6">
                  <div class="row">
                    <p class="col-md-12"><b>Residue pairs to show:</b></p>
                    <div class="dropdown col-md-12">
                      <select class="btn" id="ac_protsel" name="ac_protsel" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        None selected <span class="caret"></span>
                        <option data-btn="ac_protsel" class="ac_option ac_inoption" selected value="wh" >All</option>
                        <option data-btn="ac_protsel" class="ac_option ac_inoption" value="in" >In contact (GetContacts criteria)</option>
                        <option data-btn="ac_protsel" class="ac_option ac_inoption" value="it" >Inter-helix</option>
                        <option data-btn="ac_protsel" class="ac_option ac_inoption" value="sd" >Spatially distant</option>
                      </select>
                    </div>
                  </div>
                  <br>
                  <div class="row">
                    <p class="col-md-12"><b>Network analysis</b></p>
                    <div class="dropdown col-md-12">
                      <select class="btn" id="ac_analtype" name="ac_analtype" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        None selected <span class="caret"></span>
                        <option data-btn="ac_analtype" class="ac_option ac_inoption" value="btw" >Betweeness centrality</option>
                        <option data-btn="ac_analtype" class="ac_option ac_inoption" value="cfb" >Current flow betweeness centrality</option>
                        <option data-btn="ac_analtype" class="ac_option ac_inoption" selected value="rwd" >Raw data</option>
                      </select>
                    </div>
                  </div>
                  <br>
                  <div class="row">
                    <p class="col-md-12"><b>Number of edges</b><p>
                    <div class='col-md-12'>
                      <!--<input class="slider_ac slider_volmap" data-valtype="transparency" data-map="occupancy" value="5" min="1" max="10" step="1" type="range" name="ac_nedges" oninput="this.nextElementSibling.value = this.value" required>
                      <output id="slider_val_ac">5</output>-->
                      <input type="number" name="ac_nedges" value="5" placeholder="5">
                    </div>
                  </div>
                  <br>
                  <button class="btn btn-success btn-sm" id="ac_submit" type="submit">Show in structure</button>
                  <a href="/dynadb/files/Precomputed/allosteric_communication/dyn{{dyn_id}}/" id="download_ac" class="hidden_div">Download AC data <span class="glyphicon glyphicon-download-alt"></span></a>
                </div>
              </div>

              <br>
              <div id="ac_placeholder"></div>
              <div id="ac_results" class="container-fluid">

                <h4 style="text-align: center"><b>Results</b></h4>
                <div class="col-md-8">
                  <div id="ac_table_container" class="row"></div>
                  <div class="row">
                    <div data-selreps="[]" id="ac_show_selected" class="btn btn-info btn-sm">Show selected only</div>
                    <div data-allreps="[]" id="ac_clearsel" class="btn btn-danger btn-sm">Clear selection</div>
                  </div>
                </div>
                <div  id="ac_legends">
                  <div id="ac_legend_wtbl" class="col-md-6 ac_legend">
                    <div id="ac_legendbar_wtbl" class="ac_legendbar wtbl col-md-6"></div>                
                    <div class="col-md-6 ac_legend_numbers">
                      <p class="ac_legend_number ac_legend_min">0</p>
                      <p class="ac_legend_number ac_legend_int"></p>
                      <p class="ac_legend_number ac_legend_max">1</p>
                    </div>
                  </div>
                  <div id="ac_legend_wtyl" class="col-md-6 ac_legend">
                    <div id="ac_legendbar_wtyl" class="ac_legendbar wtyl col-md-6"></div>                
                    <div class="col-md-6 ac_legend_numbers">
                      <p class="ac_legend_number ac_legend_min">0</p>
                      <p class="ac_legend_number ac_legend_int"></p>
                      <p class="ac_legend_number ac_legend_max">-1</p>
                    </div>
                  </div>
                </div>
                <br>

              </div>
              <div class="container-fluid">
                <span class="ac_loading" ><center ><img class="img_acloading" src="{% static 'view/images/loading-gear.gif' %}"/></center></span>
                <div id="error_ac" class="error_ac alert alert-danger">
                  An unexpected error occurred.
                </div>
                <div id="ac_nofile" class="alert alert-warning">
                  No AC values are avaliable yet for this parameters selection.
                </div>
              </div>
            </div> 
          </form>
          {% endif %}

          </div>
        {% endif %}
        </div><!-- End of ALL analysis --->

        {% endif %}
                
<!-- ANALYSIS END -->        


      </div>
      </div>
     </div>
     </div>
     </div>
    </div><!-- end group_height -->
  </div><!-- end inner_remaining -->

{% endblock content %} 

{% block addon_js %} 
       <script src="{% static 'view/emb_ngl_viewer.js' %}"></script>
 <!-- Flare plots -->
        <link rel="stylesheet" type="text/css" href="{% static 'view/fplot2/docs/css/flareplot-main.css' %}" />
        <script src="{% static 'view/fplot2/d3.v3.min.js' %}"></script>
        <script src="{% static 'view/fplot2/docs/js/flareplot-main.js' %}"></script><!-- D:< -->
        <script src="{% static 'view/metadynview.js' %}"></script>
 <!-- End Flare plots -->
 <!-- Bokeh -->
{% if is_debug %}
  <link href="https://cdn.pydata.org/bokeh/release/bokeh-3.0.3.min.css" rel="stylesheet" type="text/css">
  <link href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-3.0.3.min.css" rel="stylesheet" type="text/css">
  <script src="https://cdn.pydata.org/bokeh/release/bokeh-3.0.3.min.js"></script>
  <script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-3.0.3.min.js"></script>
{% else %}
<link href="https://cdn.pydata.org/bokeh/release/bokeh-3.0.3.min.css" rel="stylesheet" type="text/css">
<link href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-3.0.3.min.css" rel="stylesheet" type="text/css">
<script src="https://cdn.pydata.org/bokeh/release/bokeh-3.0.3.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-3.0.3.min.js"></script>
{% endif %}
{% if script_cs %}
{{ script_cs | safe }}
{% endif %}
 <!-- End Bokeh -->
 <!-- Bootstrap select -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.8.1/css/bootstrap-select.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.8.1/js/bootstrap-select.js"></script>
<!-- End Bootstrap select -->

<!-- Datatable - Old links, to delete-->
<!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script> -->
<!-- End Datatable -->

<!-- Updated datatable links, with buttons and selection -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.13.1/sl-1.5.0/datatables.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.5.0/css/select.dataTables.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.2/css/buttons.dataTables.min.css"/>

<script type="text/javascript" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/select/1.5.0/js/dataTables.select.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.2/js/dataTables.buttons.min.js"></script>

{% endblock %}


</body>
